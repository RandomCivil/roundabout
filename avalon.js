define("avalon",function(){function i(){avalon.config.debug&&console.log.apply(console,arguments)}function s(){return Object.create(null)}function T(e){return Function.apply(N,e)}function N(){}function C(e,t){typeof e=="string"&&(e=e.match(f)||[]);var n={},r=t!==void 0?t:1;for(var i=0,s=e.length;i<s;i++)n[e[i]]=r;return n}function L(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return NaN}function M(e,t){return e=Math.floor(e)||0,e<0?Math.max(t+e,0):Math.min(e,t)}function H(e){if(e&&typeof e=="object"){var t=e.length,n=m.call(e);if(/(Array|List|Collection|Map|Arguments)\]$/.test(n))return!0;if(n==="[object Object]"&&t===t>>>0)return!0}return!1}function R(e){for(var t in e){if(!v.call(e,t))continue;var n=e[t];typeof R.plugins[t]=="function"?R.plugins[t](n):typeof R[t]=="object"?avalon.mix(R[t],n):R[t]=n}return this}function J(e){return(e+"").replace($,"\\$&")}function Q(e,n){var r=this.$events||(this.$events={}),i=r[e]||(r[e]=[]);if(typeof n=="function"){var s=n;s.uniqueNumber=Math.random(),n={element:w,type:"user-watcher",handler:N,vmodels:[this],expr:e,uniqueNumber:s.uniqueNumber},n.wildcard=/\*/.test(e)}if(!n.update){if(/\w\.*\B/.test(e)){n.getter=N;var o=this;n.update=function(){var e=this.fireArgs||[];e[2]&&n.handler.apply(o,e),delete this.fireArgs},i.sync=!0,avalon.Array.ensure(i,n)}else avalon.injectBinding(n);s&&(n.handler=s)}else n.oneTime||avalon.Array.ensure(i,n);return function(){n.update=n.getter=n.handler=N,n.element=t.createElement("a")}}function G(e,t){var n=this.$events;if(n&&n[e]){t&&(t[2]=e),Z(n[e],t);var r=this.$up;r&&(this.$pathname&&G.call(r,this.$pathname+"."+e,t),G.call(r,"*."+e,t))}else{r=this.$up;if(r){var i=this.$pathname+"."+e,s=i.split(".");s.indexOf("*")===-1?(G.call(r,i,t),s[1]="*",G.call(r,s.join("."),t)):G.call(r,i,t)}}}function Y(e,t){do{if(e.$watch){var n=e.$events||(e.$events={}),r=n[t]||(n[t]=[]);bt.collectDependency(r);return}e=e.$up;if(!e)break;t=e.$pathname+"."+t}while(!0)}function Z(e,t){if(!e)return;new Date-Ct>444&&typeof e[0]=="object"&&Ot();var n=[],r=[];for(var i=0,s;s=e[i++];)s.type==="user-watcher"?n.push(s):r.push(s);if(R.async){$n.render();for(i=0;s=r[i++];)if(s.update){var o=Lt(s);$n.queue[o]||($n.queue[o]=1,$n.queue.push(s))}}else for(i=0;s=r[i++];)s.update&&s.update();for(i=0;s=n[i++];){if(t&&t[2]===s.expr||s.wildcard)s.fireArgs=t;s.update()}}function nt(e,t){return t=t||{},t.watch=!0,it(e,t)}function rt(){}function it(e,t){function m(e){return f[e]===!0}if(!e||e.$id&&e.$accessors)return e;t=t||a;var n=t.force||a,r=t.old,s=r&&r.$accessors||a,o=new rt,u={},f={},l=[],c=[],h={};e.$skipArray&&(h=C(e.$skipArray),delete e.$skipArray);var p=e.$computed;if(p){delete e.$computed;for(var d in p)f[d]=!0,function(e,t){var n;u[e]={get:function(){return n=t.get.call(this)},set:function(r){if(typeof t.set=="function"){var i=n;t.set.call(this,r);var s=this[e];this.$fire&&s!==i&&this.$fire(e,s,i)}},enumerable:!0,configurable:!0}}(d,p[d])}for(d in e){var v=e[d];tt[d]||(f[d]=!0),typeof v=="function"||v&&v.nodeType||!n[d]&&(d.charAt(0)==="$"||tt[d]||h[d])?l.push(d):st(v)?(i("warning:计算属性建议放在$computed对象中统一定义"),function(e,t){var n;u[e]={get:function(){return n=t.get.call(this)},set:function(r){if(typeof t.set=="function"){var i=n;t.set.call(this,r);var s=this[e];this.$fire&&s!==i&&this.$fire(e,s,i)}},enumerable:!0,configurable:!0}}(d,v)):(c.push(d),s[d]?u[d]=s[d]:u[d]=ot(d,v))}u.$model=ct,o=Object.defineProperties(o,u,e),l.forEach(function(t){o[t]=e[t]}),ft(o,"$id","anonymous"),ft(o,"$up",r?r.$up:null),ft(o,"$track",Object.keys(f)),ft(o,"$active",!1),ft(o,"$pathname",r?r.$pathname:""),ft(o,"$accessors",u),ft(o,"hasOwnProperty",m),t.watch&&(ft(o,"$watch",function(){return Q.apply(o,arguments)}),ft(o,"$fire",function(e,t){if(e.indexOf("all!")===0){var n=e.slice(4);for(var r in avalon.vmodels){var i=avalon.vmodels[r];i.$fire&&i.$fire.apply(i,[n,t])}}else G.call(o,e,[t])})),c.forEach(function(t){var n=o[t]=e[t];n&&typeof n=="object"&&(n.$up=o,n.$pathname=t),G.call(o,t)});for(d in p)v=o[d];return o.$active=!0,o}function st(e){if(e&&typeof e=="object"){for(var t in e)if(t!=="get"&&t!=="set")return!1;return typeof e.get=="function"}}function ot(e,t){var n,t=NaN;return{get:function(){return this.$active&&Y(this,e),t},set:function(r){if(t===r)return;var i=t;n=ut(r,t),n?t=n:(n=void 0,t=r),Object(n)===n&&(n.$pathname=e,n.$up=this),this.$active&&G.call(this,e,[t,i])},enumerable:!0,configurable:!0}}function ut(e,t,n,r){if(Array.isArray(e))return at(e,t,r);if(avalon.isPlainObject(e)){if(t){var i=Object.keys(e),s=Object.keys(t);if(i.join(";")===s.join(";")){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}t.$active=!1}return it(e,{old:t,watch:r})}if(n)return e}function at(e,t,n){if(t){var r=[0,t.length].concat(e);return t.splice.apply(t,r),t}for(var i in dt)e[i]=dt[i];ft(e,"$up",null),ft(e,"$pathname",""),ft(e,"$track",gt(e.length)),e._=it({length:NaN},{watch:!0}),e._.length=e.length,e._.$watch("length",function(t,n){G.call(e.$up,e.$pathname+".length",[t,n])}),n&&ft(e,"$watch",function(){return Q.apply(e,arguments)}),Object.defineProperty(e,"$model",ct);for(var s=0,o=e.length;s<o;s++){var u=e[s]=ut(e[s],0,1,1);Object(u)===u&&(u.$up=e)}return e}function ft(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0})}function lt(e){var t=avalon.type(e);if(t==="array"){var n=[];for(var r=0;r<e.length;r++)n[r]=lt(e[r]);return n}if(t==="object"){var i={};for(r in e)if(e.hasOwnProperty(r)){var s=e[r];i[r]=s&&s.nodeType?s:lt(s)}return i}return e}function mt(e,t){var n={};for(var r=0,i=t.length;r<i;r++){n[r]=e[r];var s=t[r];s in n?(e[r]=n[s],delete n[s]):e[r]=e[s]}}function gt(e){var t=[];for(var n=0;n<e;n++)t[n]=k("$proxy$each");return t}function yt(e,t,n){switch(t){case"push":case"unshift":n=gt(n.length);break;case"splice":if(n.length>2){var r=n[1],i=n.length-2;n=[n[0],n[1]].concat(gt(n.length-2))}}Array.prototype[t].apply(e,n)}function Et(){return new Date-0}function St(e,t){if(t.oneTime)return;e&&avalon.Array.ensure(e,t)&&t.element&&(At(t,e),new Date-Ct>444&&Ot())}function xt(e,t){var n=[];for(var r=0,i;i=e[r++];)n.push(t?i.$id:i.$key);return n.join(";")}function Lt(e){if(!e.uniqueNumber){var t=e.element;t?t.nodeType!==1?e.uniqueNumber=e.type+"-"+Lt(t.parentNode)+"-"+ ++Tt:e.uniqueNumber=e.name+"-"+Lt(t):e.uniqueNumber=++Tt}return e.uniqueNumber}function At(e,t){var n=e.lists||(e.lists=[]),r=Lt(e);avalon.Array.ensure(n,t),t.$uuid=t.$uuid||k(),Nt[r]||(Nt[r]=1,Nt.push(e))}function Ot(e){var t=Nt.length,n=t,r=[],i={},s={};while(e=Nt[--t]){var o=e.type;s[o]?s[o]++:(s[o]=1,r.push(o))}var u=!1;r.forEach(function(e){kt[e]!==s[e]&&(i[e]=1,u=!0)}),t=n;if(u)while(e=Nt[--t]){if(e.element===null){Nt.splice(t,1);continue}if(i[e.type]&&_t(e.element)){Nt.splice(t,1),delete Nt[e.uniqueNumber];var a=e.lists;for(var f=0,l;l=a[f++];)avalon.Array.remove(a,l),avalon.Array.remove(l,e);Mt(e)}}kt=s,Ct=new Date}function Mt(e){delete Nt[e.uniqueNumber],e.element=null,e.rollback&&e.rollback();for(var t in e)e[t]=null}function _t(e){try{var t=e.parentNode.nodeType}catch(n){return!0}return e.ifRemove&&!w.contains(e.ifRemove)&&r===e.parentNode?(e.parentNode&&e.parentNode.removeChild(e),!0):e.msRetain?0:e.nodeType===1?!w.contains(e):!avalon.contains(w,e)}function It(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function qt(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function Ut(e){try{if(typeof e=="object")return e;e=e==="true"?!0:e==="false"?!1:e==="null"?null:+e+""===e?+e:Rt.test(e)?JSON.parse(e):e}catch(t){}return e}function zt(e){return e.window&&e.document?e:e.nodeType===9?e.defaultView:!1}function Kt(e,t){if(e.offsetWidth<=0){var n=getComputedStyle(e,null);if(Jt.test(n.display)){var r={node:e};for(var i in $t)r[i]=n[i],e.style[i]=$t[i];t.push(r)}var s=e.parentNode;s&&s.nodeType===1&&Kt(s,t)}}function Qt(e){var t=e.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(e.type)?"checked":t}function nn(e,t){var n=[],r=!!t;t=t||0;var i="unknown",s="";for(var o=0;o<e.length;o++){var u=e.charAt(o);if(u==="'"||u==='"')i==="unknown"?i=u:i===u&&(i="unknown");else if(u==="\\")(i==="'"||i==='"')&&o++;else if(en.test(u))i==="unknown"?(i="variable",s=u):i==="maybePath"?(s=n.pop(),s+="."+u,i="variable"):i==="variable"&&(s+=u);else if(/\w/.test(u))i==="variable"&&(s+=u);else if(u===".")i==="variable"&&s&&(n.push(s),s="",i="maybePath");else if(u==="["){if(i==="variable"||i==="maybePath"){s&&(n.push(s),s="");var a=n.length,f=n[a-1],l=nn(e.slice(o),o);if(l.length)n[a-1]=f+".*",n=l.concat(n);else{var c=e.slice(o+1,l.i);try{var h=T(["return "+c])();n[a-1]=f+"."+h}catch(p){}}i="maybePath",o=l.i}}else if(u==="]"){if(r)return n.i=o+t,rn(n,s),n}else tn.test(u)&&u!=="\r"&&u!=="\n"?i==="variable"&&(rn(n,s)&&(i="maybePath"),s=""):(rn(n,s),i="unknown",s="")}return rn(n,s),n}function rn(e,t){if(t&&!Yt[t])return e.push(t),!0}function sn(e,t,n,r){var i=[],s=" = "+n+".";for(var o=e.length,u;u=e[--o];){var a=u.split("."),f,l=a[0];while(f=a.shift())t.hasOwnProperty(f)&&(i.push(l+s+l),r.observers.push({v:t,p:u}),e.splice(o,1))}return i}function fn(e){e=e.trim();var t=un.get(e);if(t)return t.concat();var n=nn(e),r={},i=[];for(var s=0,o;o=n[s++];)r[o]||(r[o]=1,i.push(o));return un.put(e,i).concat()}function ln(e,t,n){var r=n.filters;typeof r=="string"&&r.trim()&&!n._filters&&(n._filters=gn(r.trim()));var i=fn(e),s=new Date-0,o=[],u=[],a=[];n.observers=[];for(var f=0,l=t.length;f<l;f++)if(i.length){var c="vm"+s+"_"+f;u.push(c),a.push(t[f]),o.push.apply(o,sn(i,t[f],c,n))}n.args=a;var h=n.type,p=t.map(function(e){return String(e.$id).replace(on,"$1")})+e+h,d=an.get(p);if(d){if(h==="duplex"){var v=an.get(p+"setter");n.setter=v.apply(v,n.args)}return n.getter=d}o.length||o.push("fix"+s);if(h==="duplex"){var m={};o.forEach(function(e){var t=e.split("=");m[t[0].trim()]=t[1].trim()}),e=e.replace(/[\$\w]+/,function(e){return m[e]?m[e]:e});var g=T(u.concat("'use strict';return function(vvv){"+e+" = vvv\n}\n"));an.put(p+"setter",g),n.setter=g.apply(g,n.args)}if(h==="on"){e.indexOf("(")===-1?e+=".call(this, $event)":e=e.replace("(",".call(this,"),u.push("$event"),e="\nreturn "+e+";";var y=e.lastIndexOf("\nreturn"),b=e.slice(0,y),w=e.slice(y);e=b+"\n"+w}else e="\nreturn "+e+";";return d=T(u.concat("'use strict';\nvar "+o.join(",\n")+e)),an.put(p,d)}function cn(e){var t=W.test(e);if(t){var n=Wn(e);return n.length===1?n[0].expr:n.map(function(e){return e.type?"("+e.expr+")":yn(e.expr)}).join(" + ")}return e}function gn(e){return e=e.replace(hn,"").replace(pn,function(){return"],|"}).replace(dn,function(e,t){return"["+yn(t)}).replace(vn,function(){return'"],["'}).replace(mn,function(){return'",'})+"]",T(["return ["+e+"]"])()}function wn(e,t,n){var r=setTimeout(function(){var i=e.innerHTML;clearTimeout(r),i===n?t():wn(e,t,i)})}function En(e,t){var n=e.getAttribute("avalonctrl")||t.$id;e.setAttribute("avalonctrl",n),t.$events&&(t.$events.expr=e.tagName+'[avalonctrl="'+n+'"]')}function xn(e,t){for(var n=0,r;r=e[n++];)r.vmodels=t,P[r.type].init(r),avalon.injectBinding(r),r.getter&&r.element.nodeType===1&&r.element.removeAttribute(r.name);e.length=0}function An(e,t){return e.priority-t.priority}function On(e,t,n){var r=!0;if(t.length){var s=e.attributes,o=[],u={};for(var a=0,f;f=s[a++];){var l=f.name;if(u[l])continue;u[l]=1;if(f.specified)if(n=l.match(Cn)){var c=n[1],h=n[2]||"",p=f.value;kn[c]?(h=c,c="on"):Ln[c]&&(h=c,c="attr",l="ms-"+c+"-"+h,i("warning!请改用"+l+"代替"+f.name+"!"));if(P[c]){var d=p.replace(Nn,""),v=p!==d,m={type:c,param:h,element:e,name:l,expr:d,oneTime:v,priority:(P[c].priority||c.charCodeAt(0)*10)+(Number(h.replace(/\D/g,""))||0)};if(c==="html"||c==="text"){var g=zn(p).filters;m.expr=m.expr.replace(g,""),m.filters=g.replace(Fn,function(){return m.type="html",m.group=1,""}).trim()}else if(c==="duplex")var y=l;else if(l==="ms-if-loop")m.priority+=100;else if(l==="ms-attr-value")var b=l;o.push(m)}}}if(o.length){o.sort(An),y&&b&&e.type==="text"&&i("warning!一个控件不能同时定义ms-attr-value与"+y);for(a=0;m=o[a];a++){c=m.type;if(Mn.test(c))return xn(o.slice(0,a+1),t);r&&(r=!_n.test(c))}xn(o,t)}}r&&!bn[e.tagName]&&(Tn&&Tn(e),Hn(e,t))}function Pn(e){var t=e.attributes,n={};for(var r=0,i;i=t[r++];)i.specified&&!Dn.test(i.name)&&(n[qt(i.name)]=Ut(i.value));return n}function Hn(e,t){var n=avalon.slice(e.childNodes);Bn(n,t)}function Bn(e,t){for(var n=0,r;r=e[n++];)switch(r.nodeType){case 1:var i=r,s;jn(r,t);if(!i.msResolved&&i.parentNode&&i.parentNode.nodeType===1){var o=Yn(i);if(o){var u=i.localName?i.localName.replace(o+":",""):i.nodeName,a=o+":"+qt(u);Jn.push({library:o,element:i,fullName:a,widget:u,vmodels:t,name:"widget"}),avalon.components[a]&&avalon.component(a)}}r.msHasEvent&&avalon.fireDom(r,"datasetchanged",{bubble:r.msHasEvent});break;case 3:W.test(r.nodeValue)&&Xn(r,t,n)}}function jn(e,t,n){var r=e.getAttribute("ms-skip"),i=e.getAttributeNode("ms-important"),s=e.getAttributeNode("ms-controller");if(typeof r=="string")return;if(n=i||s){var o=avalon.vmodels[n.value];if(!o)return;t=n===i?[o]:[o].concat(t),e.removeAttribute(n.name),e.classList.remove(n.name),En(e,o)}On(e,t)}function zn(e){if(e.indexOf("|")>0){var t=e.replace(Un,function(e){return Array(e.length+1).join("1")}),n=t.replace(In,"ᄢ㍄").indexOf("|");if(n>-1)return{type:"text",filters:e.slice(n).trim(),expr:e.slice(0,n)}}return{type:"text",expr:e,filters:""}}function Wn(e){var t=[],n,r=0,i;do{i=e.indexOf(U,r);if(i===-1)break;n=e.slice(r,i),n&&t.push({expr:n}),r=i+U.length,i=e.indexOf(z,r);if(i===-1)break;n=e.slice(r,i),n&&t.push(zn(n,r)),r=i+z.length}while(1);return n=e.slice(r),n&&t.push({expr:n}),t}function Xn(e,n,r){var i=[],s=Wn(e.data);if(s.length){for(var o=0,u;u=s[o++];){var a=t.createTextNode(u.expr);u.type&&(u.expr=u.expr.replace(Nn,function(){return u.oneTime=!0,""}),u.element=a,u.filters=u.filters.replace(Fn,function(){return u.type="html",""}),u.pos=r*1e3+o,i.push(u)),E.appendChild(a)}e.parentNode.replaceChild(E,e),i.length&&xn(i,n)}}function Gn(e,t){if(t)for(var n=0,r;r=e[n++];)if(r.hasOwnProperty(t)&&typeof r[t]=="object"){var i=r[t];return i.$model||i}return{}}function Yn(e){if(e.scopeName&&e.scopeName!=="HTML")return e.scopeName;var t=e.nodeName.toLowerCase(),n=t.indexOf(":");if(n>0)return t.slice(0,n)}function ur(e){return e==null?"":e}function ar(e,t,n,r){return t.param.replace(l,function(r){var i=avalon.duplexHooks[r];i&&typeof i[n]=="function"&&(e=i[n](e,t))}),e}function cr(){for(var e=lr.length-1;e>=0;e--){var t=lr[e];t()===!1&&lr.splice(e,1)}lr.length||clearInterval(fr)}function wr(e,t){if(!e||e.nodeType!==1)return null;if(t)var n=t.effectName,r=t.effectDriver;else n=e.getAttribute("data-effect-name"),r=e.getAttribute("data-effect-driver");if(!n||!r)return null;var i=br.pop()||new Tr;return i.el=e,i.driver=r,i.useCss=r!=="j",i.useCss&&(t&&avalon(e).addClass(t.effectClass),i.cssEvent=r==="t"?vr:mr),i.name=n,i.callbacks=avalon.effects[n]||{},i}function Er(e,t){var n=e.getAttribute("data-effect-name");if(n){t.effectName=n,t.effectDriver=e.getAttribute("data-effect-driver");var r=+e.getAttribute("data-effect-stagger");t.effectLeaveStagger=+e.getAttribute("data-effect-leave-stagger")||r,t.effectEnterStagger=+e.getAttribute("data-effect-enter-stagger")||r,t.effectClass=e.className||NaN}}function Sr(e){return e.replace(/^[\S]/g,function(e){return e.toUpperCase()})}function Tr(){}function Nr(e,t){var n=e.callbacks[t+"Class"];return typeof n=="string"?n:typeof n=="function"?n():e.name+"-"+t}function Cr(e,t,n){var r=e.callbacks[t];r&&r.call(e,e.el,n)}function _r(e,n,r){var i=e.templateCache&&e.templateCache[n];if(i){var s=t.createDocumentFragment(),o;while(o=i.firstChild)s.appendChild(o);return s}return avalon.parseHTML(r)}function Dr(e){var n=t.createDocumentFragment();for(var r=0,i=e.length;r<i;r++)n.appendChild(e[r]);return n}function Br(e,t,n){for(var r=0,i;i=e[r++];)i.className===n.effectClass&&avalon.effect.apply(i,t,N,N,n)}function jr(e,t,n){return e?setTimeout(t,++n*e):t(),n}function Fr(e,t){var n=E.cloneNode(!1),r=e,i=r.nodeValue,s=t&&Math.max(+t.staggerIndex,0),o=avalon.slice(r.parentNode.childNodes),u=o.indexOf(r);for(;;){var a=o[--u];if(!a||String(a.nodeValue).indexOf(i)===0)break;t&&a.className===t.effectClass?(e=a,function(e){t.staggerIndex=jr(t.effectLeaveStagger,function(){avalon.effect.apply(e,0,N,function(){n.appendChild(e)},t)},s)}(a)):n.insertBefore(a,n.firstChild)}return n.appendChild(r),n}function Ir(e,t,n,r,i){var s=e.template.cloneNode(!0),o=avalon.slice(s.childNodes);s.appendChild(n.$anchor),i&&t.appendChild(s);var u=[n].concat(e.vmodels),a={nodes:o,vmodels:u,content:s};r.push(a)}function qr(e){var t=e.xtype==="object"?Vr:Ur,n=t(e),r=n.$anchor||(n.$anchor=e.element.cloneNode(!1));return r.nodeValue=e.signature,n.$outer=e.$outer,n}function Ur(e,t){var n=e.param||"el";for(var r=0,i=Rr.length;r<i;r++){var s=Rr[r];if(s&&s.hasOwnProperty(n)){Rr.splice(r,1),t=s;break}}return t||(t=zr(n)),t}function zr(e){var t={$outer:{},$index:0,$oldIndex:0,$anchor:null,$first:!1,$last:!1,$remove:avalon.noop};t[e]=NaN;var n={$last:1,$first:1,$index:1};n[e]=1;var r=nt(t,{force:n});return r.$id=k("$proxy$each"),r}function Wr(e,t,n){if(n==="array"){e.$remove=function(){t.$repeat.removeAt(e.$index)};var r=t.param;e.$watch(r,function(n){var r=e.$index;t.$repeat[r]=n})}else e.$watch("$val",function(r){t.$repeat[e.$key]=r})}function Vr(){return Xr.pop()||$r()}function $r(){var e=nt({$key:"",$val:NaN,$index:0,$oldIndex:0,$outer:{},$anchor:null},{force:{$key:1,$val:1,$index:1}});return e.$id=k("$proxy$with"),e}function Jr(e,t,n){var r=e[t];if(r){var i=r.$id.indexOf("$proxy$each")===0?Rr:Xr;r.$outer={};for(var s in r.$events){var o=r.$events[s];Array.isArray(o)&&(o.length=0,s===n?r[n]=NaN:s==="$val"&&(r.$val=NaN))}i.unshift(r)>R.maxRepeatSize&&i.pop(),delete e[t]}}function Kr(e,n){var r="_"+e;if(!Kr[r]){var i=t.createElement(e);w.appendChild(i),b?n=getComputedStyle(i,null).display:n=i.currentStyle.display,w.removeChild(i),Kr[r]=n}return Kr[r]}function ni(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):3,o=r||",",u=n||".",a="",f=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return a=(s?f(i,s):""+Math.round(i)).split("."),a[0].length>3&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(a[1]||"").length<s&&(a[1]=a[1]||"",a[1]+=(new Array(s-a[1].length+1)).join("0")),a.join(u)}var e=Date.now(),t=window.document,n=t.head;n.insertAdjacentHTML("afterBegin",'<avalon ms-skip class="avalonHide"><style id="avalonStyle">.avalonHide{ display: none!important }</style></avalon>');var r=n.firstChild,o="$"+e,u=!1,a={},f=/[^, ]+/g,l=/\w+/g,c=/^(?:object|array)$/,h=/^\[object SVG\w*Element\]$/,p=/^\[object (?:Window|DOMWindow|global)\]$/,d=Object.prototype,v=d.hasOwnProperty,m=d.toString,g=Array.prototype,y=g.slice,b=window.dispatchEvent,w=t.documentElement,E=t.createDocumentFragment(),S=t.createElement("div"),x={};"Boolean Number String Function Array Date RegExp Object Error".replace(f,function(e){x["[object "+e+"]"]=e.toLowerCase()});var k=function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,e)},A=L();avalon=function(e){return new avalon.init(e)},avalon.nextTick=new function(){function r(){var e=n.length;for(var t=0;t<e;t++)n[t]();n=n.slice(e)}var e=window.setImmediate,t=window.MutationObserver;if(e)return e.bind(window);var n=[];if(t){var i=document.createTextNode("avalon");(new t(r)).observe(i,{characterData:!0});var s=!1;return function(e){n.push(e),s=!s,i.data=s}}return function(e){setTimeout(e,4)}},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?x[m.call(e)]||"object":typeof e};var O=function(e){return m.call(e)==="[object Function]"};avalon.isFunction=O,avalon.isWindow=function(e){return p.test(m.call(e))},avalon.isPlainObject=function(e){return m.call(e)==="[object Object]"&&Object.getPrototypeOf(e)===d},avalon.mix=avalon.fn.mix=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u++),typeof o!="object"&&!O(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(avalon.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&avalon.isPlainObject(n)?n:{},o[t]=avalon.mix(f,s,r)):r!==void 0&&(o[t]=r)}return o},avalon.mix({rword:f,subscribers:o,version:1.54,ui:{},log:i,slice:function(e,t,n){return y.call(e,t,n)},noop:N,error:function(e,t){throw new(t||Error)(e)},oneObject:C,range:function(e,t,n){n||(n=1),t==null&&(t=e||0,e=0);var r=-1,i=Math.max(0,Math.ceil((t-e)/n)),s=new Array(i);while(++r<i)s[r]=e,e+=n;return s},eventHooks:{},bind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t];return typeof s=="object"&&(t=s.type||t,r=s.phase||!!r,n=s.fn?s.fn(e,n):n),e.addEventListener(t,n,r),n},unbind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t],o=n||N;typeof s=="object"&&(t=s.type||t,r=s.phase||!!r),e.removeEventListener(t,o,r)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?qt(t):t,i;t=avalon.cssName(r)||r;if(n===void 0||typeof n=="boolean"){i=Wt[r+":get"]||Wt["@:get"],t==="background"&&(t="backgroundColor");var s=i(e,t);return n===!0?parseFloat(s)||0:s}if(n==="")e.style[t]="";else{if(n==null||n!==n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),i=Wt[r+":set"]||Wt["@:set"],i(e,t,n)}},each:function(e,t){if(e){var n=0;if(H(e)){for(var r=e.length;n<r;n++)if(t(n,e[n])===!1)break}else for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var i in n)i.indexOf(t)===0&&(r[i.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[i]);return r},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}});var _=avalon.bindingHandlers={},D=avalon.bindingExecutors={},P=avalon.directives={};avalon.directive=function(e,t){return _[e]=t.init=t.init||N,D[e]=t.update=t.update||N,P[e]=t};var B=new function(){function e(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var t=e.prototype;return t.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},t.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key])},t.get=function(e){var t=this._keymap[e];if(t===void 0)return;return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},e};t.contains||(Node.prototype.contains=function(e){return!!(this.compareDocumentPosition(e)&16)}),avalon.contains=function(e,t){try{while(t=t.parentNode)if(t===e)return!0;return!1}catch(n){return!1}};if(window.SVGElement){var j="http://www.w3.org/2000/svg",F=t.createElementNS(j,"svg");F.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!h.test(F.firstChild)){function I(e,n){if(e&&e.childNodes){var r=e.childNodes;for(var i=0,s;s=r[i++];)if(s.tagName){var o=t.createElementNS(j,s.tagName.toLowerCase());g.forEach.call(s.attributes,function(e){o.setAttribute(e.name,e.value)}),I(s,o),n.appendChild(o)}}}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:function(){return(new XMLSerializer).serializeToString(this)},set:function(e){var n=this.tagName.toLowerCase(),r=this.parentNode,i=avalon.parseHTML(e);if(n==="svg")r.insertBefore(i,this);else{var s=t.createDocumentFragment();I(i,s),r.insertBefore(s,this)}r.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(e);I(t,this)}}}})}}var q=avalon.eventHooks;"onmouseenter"in w||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){q[e]={type:t,fn:function(t,n){return function(r){var i=r.relatedTarget;if(!i||i!==t&&!(t.compareDocumentPosition(i)&16))return delete r.type,r.type=e,n.call(t,r)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!q.animationend&&(q.animationend={type:t})}),t.onmousewheel===void 0&&(q.mousewheel={type:"wheel",fn:function(e,t){return function(n){n.wheelDeltaY=n.wheelDelta=n.deltaY>0?-120:120,n.wheelDeltaX=0,Object.defineProperty(n,"type",{value:"mousewheel"}),t.call(e,n)}}});var U,z,W,X,V,$=/[-.*+?^${}()|[\]\/\\]/g,K={interpolate:function(e){U=e[0],z=e[1];if(U===z){throw new SyntaxError("openTag!==closeTag");var t}R.openTag=U,R.closeTag=z;var n=J(U),r=J(z);W=new RegExp(n+"(.*?)"+r),X=new RegExp(n+"(.*?)"+r,"g"),V=new RegExp(n+".*?"+r+"|\\sms-")}};R.async=!0,R.debug=!0,R.plugins=K,R.plugins.interpolate(["{{","}}"]),R.paths={},R.shim={},R.maxRepeatSize=100,avalon.config=R;var et=avalon.vmodels={};avalon.define=function(e){var t=e.$id;t||i("warning: vm必须指定$id");var n=nt(e);return n.$id=t,et[t]=n};var tt=C("$id,$watch,$fire,$events,$model,$skipArray,$active,$pathname,$up,$track,$accessors"),ct={get:function(){return lt(this)},set:N,enumerable:!1,configurable:!0},ht=["push","pop","shift","unshift","splice"],pt=Array.prototype,dt={notify:function(){G.call(this.$up,this.$pathname)},set:function(e,t){if(e>>>0===e&&this[e]!==t){if(e>this.length)throw Error(e+"set方法的第一个参数不能大于原数组长度");G.call(this.$up,this.$pathname+".*",[t,this[e]]),this.splice(e,1,t)}},contains:function(e){return this.indexOf(e)!==-1},ensure:function(e){return this.contains(e)||this.push(e),this},pushArray:function(e){return this.push.apply(this,e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>>>0===e?this.splice(e,1):[]},size:function(){return this._.length},removeAll:function(e){if(Array.isArray(e))for(var t=this.length-1;t>=0;t--)e.indexOf(this[t])!==-1&&(vt.call(this.$track,t,1),vt.call(this,t,1));else if(typeof e=="function")for(t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&(vt.call(this.$track,t,1),vt.call(this,t,1))}else vt.call(this.$track,0,this.length),vt.call(this,0,this.length);b||(this.$model=lt(this)),this.notify(),this._.length=this.length},clear:function(){return this.removeAll()}},vt=pt.splice;ht.forEach(function(e){var t=pt[e];dt[e]=function(){var n=[];for(var r=0,i=arguments.length;r<i;r++)n[r]=ut(arguments[r],0,1,1);var s=t.apply(this,n);return yt(this.$track,e,n),b||(this.$model=lt(this)),this.notify(),this._.length=this.length,s}}),"sort,reverse".replace(f,function(e){dt[e]=function(){var t=this.concat(),n=this,r=Math.random(),i=[],s=!1;pt[e].apply(n,arguments);for(var o=0,u=t.length;o<u;o++){var a=n[o],f=t[o];if(a===f)i.push(o);else{var l=t.indexOf(a);i.push(l),t[l]=r,s=!0}}return s&&(mt(this.$track,i),b||(this.$model=lt(this)),this.notify()),this}});var bt=function(){var e=[],t;return{begin:function(n){e.push(t),t=n},end:function(){t=e.pop()},collectDependency:function(e){t&&t.callback(e)}}}(),wt=/^on$/;avalon.injectBinding=function(e){e.handler=e.handler||P[e.type].update||N,e.update=function(){var t=!1;e.getter||(t=!0,bt.begin({callback:function(t){St(t,e)}}),e.getter=ln(e.expr,e.vmodels,e),e.observers.forEach(function(t){t.v.$watch(t.p,e)}),delete e.observers);try{var n=e.fireArgs,r,s;delete e.fireArgs,n?(r=n[0],s=n[1]):e.type==="on"?r=e.getter+"":r=e.getter.apply(0,e.args),s=typeof s=="undefined"?e.oldValue:s,e._filters&&(r=ri.$filter.apply(0,[r].concat(e._filters)));if(e.signature){var o=avalon.type(r);if(o!=="array"&&o!=="object")throw Error("warning:"+e.expr+"只能是对象或数组");e.xtype=o;var u=xt(e.proxies||[],o),a=r.$track||(o==="array"?gt(r.length):Object.keys(r));e.track=a,u!==a.join(";")&&(e.handler(r,s),e.oldValue=1)}else if(Array.isArray(r)?r.length!==(s&&s.length):!1)e.handler(r,s),e.oldValue=r.concat();else if(!("oldValue"in e)||r!==s)e.handler(r,s),e.oldValue=r}catch(f){delete e.getter,i("warning:exception throwed in [avalon.injectBinding] ",f);var l=e.element;l&&l.nodeType===3&&(l.nodeValue=U+(e.oneTime?"::":"")+e.expr+z)}finally{t&&bt.end()}},e.update()};var Tt=0,Nt=avalon.$$subscribers=[],Ct=new Date,kt={},Dt=new function(){avalon.mix(this,{option:t.createElement("select"),thead:t.createElement("table"),td:t.createElement("tr"),area:t.createElement("map"),tr:t.createElement("tbody"),col:t.createElement("colgroup"),legend:t.createElement("fieldset"),_default:t.createElement("div"),g:t.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(f,function(e){Dt[e]=Dt.g});var Pt=/<([\w:]+)/,Ht=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Bt=C(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),jt=t.createElement("script"),Ft=/<|&#?\w+;/;avalon.parseHTML=function(e){var n=E.cloneNode(!1);if(typeof e!="string")return n;if(!Ft.test(e))return n.appendChild(t.createTextNode(e)),n;e=e.replace(Ht,"<$1></$2>").trim();var r=(Pt.exec(e)||["",""])[1].toLowerCase(),i=Dt[r]||Dt._default,s;i.innerHTML=e;var o=i.getElementsByTagName("script");if(o.length)for(var u=0,a;a=o[u++];)if(Bt[a.type]){var f=jt.cloneNode(!1);g.forEach.call(a.attributes,function(e){f.setAttribute(e.name,e.value)}),f.text=a.text,a.parentNode.replaceChild(f,a)}while(s=i.firstChild)n.appendChild(s);return n},avalon.innerHTML=function(e,t){var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},avalon.clearHTML=function(e){e.textContent="";while(e.firstChild)e.removeChild(e.firstChild);return e},"add,remove".replace(f,function(e){avalon.fn[e+"Class"]=function(t){var n=this[0];return t&&typeof t=="string"&&n&&n.nodeType===1&&t.replace(/\S+/g,function(t){n.classList[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return t.nodeType===1&&t.classList.contains(e)},toggleClass:function(e,t){var n,r=0,i=String(e).split(/\s+/),s=typeof t=="boolean";while(n=i[r++]){var o=s?t:!this.hasClass(n);this[o?"addClass":"removeClass"](n)}return this},attr:function(e,t){return arguments.length===2?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){e="data-"+It(e||"");switch(arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return Ut(n);case 0:var r={};return g.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=qt(e.slice(5)),r[e]=Ut(t.value)))}),r}},removeData:function(e){return e="data-"+It(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return r!==void 0?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(!n)return;return this.css("position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),e[0].tagName!=="HTML"&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0),r.top-=e.scrollTop(),r.left-=e.scrollLeft()),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){var e=this[0].offsetParent;while(e&&avalon.css(e,"position")==="static")e=e.offsetParent;return avalon(e||w)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&t.nodeType===1){var n=arguments.length===0,r=n?":get":":set",i=Gt[Qt(t)+r];if(i)var s=i(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?s:this}}),w.dataset&&(avalon.fn.data=function(e,t){e=e&&qt(e);var n=this[0].dataset;switch(arguments.length){case 2:return n[e]=t,this;case 1:return t=n[e],Ut(t);case 0:var r=s();for(e in n)r[e]=Ut(n[e]);return r}});var Rt=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;avalon.parseJSON=JSON.parse,avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},i=zt(r),s=e==="scrollTop";if(!arguments.length)return i?i[t]:r[e];i?i.scrollTo(s?i[t]:n,s?n:i[t]):r[e]=n}});var Wt=avalon.cssHooks=s(),Xt=["","-webkit-","-moz-","-ms-"],Vt={"float":"cssFloat"};avalon.cssNumber=C("animationIterationCount,animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"
),avalon.cssName=function(e,t,n){if(Vt[e])return Vt[e];t=t||w.style;for(var r=0,i=Xt.length;r<i;r++){n=qt(Xt[r]+e);if(n in t)return Vt[e]=n}return null},Wt["@:set"]=function(e,t,n){e.style[t]=n},Wt["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e);return r&&(n=t==="filter"?r.getPropertyValue(t):r[t],n===""&&(n=e.style[t])),n},Wt["opacity:get"]=function(e){var t=Wt["@:get"](e,"opacity");return t===""?"1":t},"top,left".replace(f,function(e){Wt[e+":get"]=function(t){var n=Wt["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var $t={position:"absolute",visibility:"hidden",display:"block"},Jt=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(f,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,i="offset"+e;Wt[t+":get"]=function(t,n,r){var s=-4;typeof r=="number"&&(s=r),n=e==="Width"?["Left","Right"]:["Top","Bottom"];var o=t[i];return s===2?o+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(s<0&&(o=o-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),s===-4&&(o=o-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),o)},Wt[t+"&get"]=function(e){var n=[];Kt(e,n);var r=Wt[t+":get"](e);for(var i=0,s;s=n[i++];){e=s.node;for(var o in s)typeof s[o]=="string"&&(e.style[o]=s[o])}return r},avalon.fn[t]=function(s){var o=this[0];if(arguments.length===0){if(o.setTimeout)return o["inner"+e];if(o.nodeType===9){var u=o.documentElement;return Math.max(o.body[r],u[r],o.body[i],u[i],u[n])}return Wt[t+"&get"](o)}return this.css(t,s)},avalon.fn["inner"+e]=function(){return Wt[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return Wt[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0];try{var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var n=e.ownerDocument,r=n.documentElement,i=n.defaultView;return{top:t.top+i.pageYOffset-r.clientTop,left:t.left+i.pageXOffset-r.clientLeft}}}catch(s){return{left:0,top:0}}};var Gt={"select:get":function(e,t){var n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&!n.disabled){t=n.value;if(s)return t;o.push(t)}}return o},"select:set":function(e,t,n){t=[].concat(t);for(var r=0,i;i=e.options[r++];)if(i.selected=t.indexOf(i.value)>-1)n=!0;n||(e.selectedIndex=-1)}},Yt={},Zt=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(",");Zt.replace(/\w+/g,function(e){Yt[e]=!0});var en=/[a-z_$]/i,tn=/[\s\uFEFF\xA0]/,on=/(\$proxy\$[a-z]+)\d+$/,un=new B(218),an=new B(128);avalon.parseExprProxy=ln;var hn=/\)\s*$/,pn=/\)\s*\|/g,dn=/\|\s*([$\w]+)/g,vn=/"\s*\["/g,mn=/"\s*\(/g,yn=JSON.stringify;avalon.scan=function(e,t){e=e||w;var n=t?[].concat(t):[];jn(e,n)};var bn=C("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),Sn=function(e,t,n){var r=e.getAttribute(t);if(r)for(var i=0,s;s=n[i++];)if(s.hasOwnProperty(r)&&typeof s[r]=="function")return s[r]},Tn=A&&window.MutationObserver?function(e){var t=e.firstChild,n;while(t){var r=t.nextSibling;t.nodeType===3?n?(n.nodeValue+=t.nodeValue,e.removeChild(t)):n=t:n=null,t=r}}:0,Nn=/^\s*::/,Cn=/ms-(\w+)-?(.*)/,kn=C("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),Ln=C("value,title,alt,checked,selected,disabled,readonly,enabled,href,src"),Mn=/^if|widget|repeat$/,_n=/^each|with|html|include$/,Dn=/^(ms-\S+|data-\S+|on[a-z]+|id|style|class|tabindex)$/,Fn=/\|\s*html(?:\b|$)/,In=/\|\|/g,qn=/&lt;/g,Rn=/&gt;/g,Un=/(['"])(\\\1|.)+?\1/g,Vn=function(){this.queue=[]};Vn.prototype={render:function(e){if(!this.locked){this.locked=e?w.offsetHeight+10:1;var t=this;avalon.nextTick(function(){t.flush()})}},flush:function(){for(var e=0,t;t=this.queue[e++];)t.update();this.locked=0,this.queue=[]}};var $n=new Vn,Jn=[],Kn=[],Qn={$construct:function(){return avalon.mix.apply(null,arguments)},$ready:N,$init:N,$dispose:N,$container:null,$childReady:N,$replace:!1,$extend:null,$$template:function(e){return e}};avalon.components={},avalon.component=function(e,t){t&&(avalon.components[e]=avalon.mix({},Qn,t));for(var n=0,r;r=Jn[n];n++)e===r.fullName&&(Jn.splice(n,1),n--,function(t,n,r,i){var s=1,o=t.library,u=avalon.libraries[o]||Qn,a=Pn(r),f=Gn(t.vmodels,a.config||t.widget),l=a.$id||a.identifier||k(i);delete a.config,delete a.$id,delete a.identifier;var c={},h=avalon.components[n.$extend];h?(avalon.mix(!0,c,h),c=h.$construct.call(r,c,{},{})):avalon.mix(!0,c,n),c=avalon.components[e].$construct.call(r,c,f,a),c.$refs={},c.$id=l;var p=c.$slot,d=c.$replace,v=c.$container,m=c.$template;delete c.$slot,delete c.$replace,delete c.$container,delete c.$template,delete c.$construct;var g=avalon.define(c)||{};r.msResolved=1,g.$init(g,r),u.$init(g,r);var y=r.childNodes,b={},w;for(var S=0,x;x=y[S++];){var T=x.nodeType===1&&x.getAttribute("slot")||p;T&&(b[T]?b[T].push(x):b[T]=[x])}g.$$template&&(avalon.clearHTML(r),r.innerHTML=g.$$template(m));for(S in b)if(g.hasOwnProperty(S)){var N=b[S];if(N.length){var C=E.cloneNode(!0);for(var L=0;w=N[L++];)C.appendChild(w);g[S]=C}b[S]=null}b=null;var A=r.firstChild;d&&(A=r.firstChild,r.parentNode.replaceChild(A,r),A.msResolved=1,r=t.element=A),v&&v.appendChild(r),avalon.fireDom(r,"datasetchanged",{library:o,vm:g,childReady:1});var O=0,M=avalon.bind(r,"datasetchanged",function(e){e.childReady&&e.library===o&&(s+=e.childReady,g!==e.vm&&(g.$refs[e.vm.$id]=e.vm,e.childReady===-1&&(O++,g.$childReady(g,r,e)),e.stopPropagation()));if(s===0){var n=setTimeout(function(){clearTimeout(n),g.$ready(g,r),u.$ready(g,r)},O?Math.max(O*17,100):17);avalon.unbind(r,"datasetchanged",M),t.rollback=function(){try{g.$dispose(g,r),u.$dispose(g,r)}catch(e){}delete avalon.vmodels[g.$id]},At(t,Kn),window.chrome&&r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(Ot)})}});jn(r,[g].concat(t.vmodels)),avalon.vmodels[g.$id]=g;if(!r.childNodes.length)avalon.fireDom(r,"datasetchanged",{library:o,vm:g,childReady:-1});else var _=setTimeout(function(){clearTimeout(_),avalon.fireDom(r,"datasetchanged",{library:o,vm:g,childReady:-1})},17)}(r,avalon.components[e],r.element,r.widget))},avalon.fireDom=function(e,n,r){if(t.createEvent){var i=t.createEvent("Events");i.initEvent(n,!0,!0,r),avalon.mix(i,r),e.dispatchEvent(i)}else w.contains(e)&&(i=t.createEventObject(),avalon.mix(i,r),e.fireEvent("on"+n,i))},avalon.libraries=[],avalon.library=function(e,n){t.namespaces&&t.namespaces.add(e,"http://www.w3.org/1999/xhtml"),avalon.libraries[e]=avalon.mix({$init:N,$ready:N,$dispose:N},n||{})},avalon.library("ms");var Zn=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),er={};Zn.replace(f,function(e){er[e.toLowerCase()]=e});var tr={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},nr=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");nr.replace(f,function(e){tr[e.toLowerCase()]=e});var rr=avalon.directive("attr",{init:function(e){e.expr=cn(e.expr.trim());if(e.type==="include"){var n=e.element;Er(n,e),e.includeRendered=Sn(n,"data-include-rendered",e.vmodels),e.includeLoaded=Sn(n,"data-include-loaded",e.vmodels);var r=e.includeReplace=!!avalon(n).data("includeReplace");avalon(n).data("includeCache")&&(e.templateCache={}),e.start=t.createComment("ms-include"),e.end=t.createComment("ms-include-end"),r?(e.element=e.end,e._element=n,n.parentNode.insertBefore(e.start,n),n.parentNode.insertBefore(e.end,n.nextSibling)):(n.insertBefore(e.start,n.firstChild),n.appendChild(e.end))}},update:function(e){var n=this.element,r=this.param;if(r==="href"||r==="src"){typeof e=="string"&&!w.hasAttribute&&(e=e.replace(/&amp;/g,"&")),n[r]=e;if(window.chrome&&n.tagName==="EMBED"){var i=n.parentNode,s=document.createComment("ms-src");i.replaceChild(s,n),i.replaceChild(n,s)}}else{var o=e===!1||e===null||e===void 0;!b&&tr[r]&&(r=tr[r]);var u=er[r];typeof n[u]=="boolean"&&(n[u]=!!e,e||(o=!0));if(o)return n.removeAttribute(r);var a=h.test(n)?!1:t.namespaces&&isVML(n)?!0:r in n.cloneNode(!1);a?n[r]=e+"":n.setAttribute(r,e)}}});"title,alt,src,value,css,include,href".replace(f,function(e){P[e]=rr}),avalon.directive("class",{init:function(e){var t=e.param,n=e.type;!t||isFinite(t)?(e.param="",P.effect.init(e)):(i("ms-"+n+'-xxx="yyy"这种用法已经过时,请使用ms-'+n+'="xxx:yyy"'),e.expr="["+yn(t)+","+e.expr+"]",e.oldStyle=t);if(n==="hover"||n==="active"){if(!e.hasBindEvent){var r=e.element,s=avalon(r),o="mouseenter",u="mouseleave";if(n==="active"){r.tabIndex=r.tabIndex||-1,o="mousedown",u="mouseup";var a=s.bind("mouseleave",function(){e.toggleClass&&s.removeClass(e.newClass)})}}var f=s.bind(o,function(){e.toggleClass&&s.addClass(e.newClass)}),l=s.bind(u,function(){e.toggleClass&&s.removeClass(e.newClass)});e.rollback=function(){s.unbind("mouseleave",a),s.unbind(o,f),s.unbind(u,l)},e.hasBindEvent=!0}},update:function(e){var t=this,n=avalon(this.element);t.newClass=e[0],t.toggleClass=!!e[1],t.oldClass&&t.newClass!==t.oldClass&&n.removeClass(t.oldClass),t.oldClass=t.newClass,t.type==="class"&&(t.oldStyle?n.toggleClass(t.oldStyle,!!e[1]):n.toggleClass(t.newClass,t.toggleClass))}}),"hover,active".replace(f,function(e){P[e]=P["class"]}),avalon.directive("css",{init:P.attr.init,update:function(e){avalon(this.element).css(this.param,e)}}),avalon.directive("data",{priority:100,update:function(e){var t=this.element,n="data-"+this.param;e&&typeof e=="object"?t[n]=e:t.setAttribute(n,String(e))}});var ir=/^(?:checkbox|radio)$/,sr=/^(?:radio|checked)$/,or=avalon.directive("duplex",{priority:2e3,init:function(e,t){function a(t){e.changed.call(this,t,e)}function f(){u=!0}function c(){u=!1}var n=e.element,r=e.vmodels;e.changed=Sn(n,"data-duplex-changed",r)||N;var s=[],o=C("string,number,boolean,checked");n.type==="radio"&&e.param===""&&(e.param="checked"),e.param.replace(l,function(r){ir.test(n.type)&&sr.test(r)&&(r==="radio"&&i("ms-duplex-radio已经更名为ms-duplex-checked"),r="checked",e.isChecked=!0,e.xtype="radio"),r==="bool"?(r="boolean",i("ms-duplex-bool已经更名为ms-duplex-boolean")):r==="text"&&(r="string",i("ms-duplex-text已经更名为ms-duplex-string")),o[r]&&(t=!0),avalon.Array.ensure(s,r)}),t||s.push("string"),e.param=s.join("-"),e.xtype||(e.xtype=n.tagName==="SELECT"?"select":n.type==="checkbox"?"checkbox":n.type==="radio"?"radio":/^change/.test(n.getAttribute("data-duplex-event"))?"change":"input"),e.bound=function(t,r){n.addEventListener(t,r,!1);var i=e.rollback;e.rollback=function(){n.avalonSetter=null,avalon.unbind(n,t,r),i&&i()}};var u=!1,h=function(){var t=n.value;if(u||t===e.oldValue)return;var r=e.pipe(t,e,"get");e.setter(r),a.call(n,r)};switch(e.xtype){case"radio":e.bound("click",function(){var t=e.pipe(n.value,e,"get");e.setter(t),a.call(n,t)});break;case"checkbox":e.bound("change",function(){var t=n.checked?"ensure":"remove",r=e.getter.apply(0,e.vmodels);Array.isArray(r)||(i("ms-duplex应用于checkbox上要对应一个数组"),r=[r]);var s=e.pipe(n.value,e,"get");avalon.Array[t](r,s),a.call(n,r)});break;case"change":e.bound("change",h);break;case"input":A?e.bound("input",h):(e.bound("input",h),e.bound("compositionstart",f),e.bound("compositionend",c),e.bound("DOMAutoComplete",h));break;case"select":e.bound("change",function(){var t=avalon(n).val();Array.isArray(t)?t=t.map(function(t){return e.pipe(t,e,"get")}):t=e.pipe(t,e,"get"),t+""!==e.oldValue&&(e.setter(t),a.call(n,t))})}e.bound("focus",function(){n.msFocus=!0}),e.bound("blur",function(){n.msFocus=!1}),e.xtype==="input"&&/^(text|password|hidden)/.test(n.type)&&(n.avalonSetter=h,hr(function(){if(w.contains(n))!n.msFocus&&e.oldValue!==n.value&&h();else if(!n.msRetain)return!1}))},update:function(e){var t=this.element,n=this,r;if(!this.init){for(var i in avalon.vmodels){var s=avalon.vmodels[i];s.$fire("avalon-ms-duplex-init",n)}var o=n.pipe||(n.pipe=ar);o(null,n,"init"),this.init=1}switch(this.xtype){case"input":case"change":r=this.pipe(e,this,"set"),r!==this.oldValue&&(t.value=this.oldValue=r);break;case"radio":r=n.isChecked?!!e:e+""===t.value,t.checked=r;break;case"checkbox":var u=[].concat(e);r=this.pipe(t.value,this,"get"),t.checked=u.indexOf(r)>-1;break;case"select":n._value=e,t.msHasEvent="selectDuplex",avalon.bind(t,"datasetchanged",function(e){if(e.bubble==="selectDuplex"){var r=n._value,i=Array.isArray(r)?r.map(String):r+"";avalon(t).val(i),t.oldValue=i+"",n.changed.call(t,i)}})}n.xtype!=="select"&&n.changed.call(t,r)}});avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:ur},"boolean":{get:function(e){return e==="true"},set:ur},number:{get:function(e,t){var n=parseFloat(e);if(-e===-n)return n;var r=/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"];switch(r[0]){case"strong":return 0;case"medium":return e===""?"":0;case"weak":return e}},set:ur}};var fr,lr=[];avalon.tick=function(e){lr.push(e)===1&&(fr=setInterval(cr,60))};var hr=N;new function(){try{var e={},t=HTMLInputElement.prototype,n=HTMLTextAreaElement.prototype;function r(t){e[this.tagName].call(this,t),!this.msFocus&&this.avalonSetter&&this.oldValue!==t&&this.avalonSetter()}var i=HTMLInputElement.prototype;Object.getOwnPropertyNames(i),e.INPUT=Object.getOwnPropertyDescriptor(t,"value").set,Object.defineProperty(t,"value",{set:r}),e.TEXTAREA=Object.getOwnPropertyDescriptor(n,"value").set,Object.defineProperty(n,"value",{set:r})}catch(s){hr=avalon.tick}},avalon.directive("effect",{priority:5,init:function(e){var t=e.expr,n,r,i=t.replace(X,function(e){return e.replace(/./g,"0")}).indexOf(":");i===-1?(n=t,r=!0):(n=t.slice(0,i),r=t.slice(i+1)),W.test(t)?n=cn(n):n=yn(n),e.expr="["+n+","+r+"]"},update:function(e){var t=e[0],n=this.element;if(n.getAttribute("data-effect-name")===t)return;n.removeAttribute("data-effect-driver");var r=n.style,i=window.getComputedStyle?window.getComputedStyle(n):null,s=!1;if(i&&(pr||dr)){var o=r[gr]||i[gr];o&&o!=="0s"&&(n.setAttribute("data-effect-driver","t"),s=!0),s||(o=r[yr]||i[yr],o&&o!=="0s"&&(n.setAttribute("data-effect-driver","a"),s=!0))}s||avalon.effects[t]&&(n.setAttribute("data-effect-driver","j"),s=!0),s&&n.setAttribute("data-effect-name",t)}}),avalon.effects={},avalon.effect=function(e,t){avalon.effects[e]=t};var pr=!1,dr=!1,vr,mr,gr=avalon.cssName("transition-duration"),yr=avalon.cssName("animation-duration");new function(){var e={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"},t;for(var n in e){if(window[n]){t=e[n];break}try{var r=document.createEvent(n);t=e[n];break}catch(i){}}typeof t=="string"&&(pr=!0,vr=t),e={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var s;for(n in e)if(window[n]){s=e[n];break}typeof s=="string"&&(pr=!0,mr=s)};var br=[],xr=new Vn;Tr.prototype={contrustor:Tr,enterClass:function(){return Nr(this,"enter")},leaveClass:function(){return Nr(this,"leave")},actionFun:function(e,t,n){if(document.hidden)return;var r=this,i=r.el,s=e==="leave";e=s?"leave":"enter";var o=s?"enter":"leave";Cr(r,"abort"+Sr(o)),Cr(r,"before"+Sr(e)),s||t(i);var u=function(o){i.removeEventListener(r.cssEvent,r.cssCallback),s?(t(i),avalon(i).removeClass(r.cssClass)):r.driver==="a"&&avalon(i).removeClass(r.cssClass),o!==!0&&(Cr(r,"after"+Sr(e)),n&&n(i)),r.dispose()};r.useCss?(r.cssCallback&&r.cssCallback(!0),r.cssClass=Nr(r,e),r.cssCallback=u,r.update=function(){i.addEventListener(r.cssEvent,r.cssCallback),!s&&r.driver==="t"&&avalon(i).removeClass(r.cssClass)},avalon(i).addClass(r.cssClass),xr.render(!0),xr.queue.push(r)):Cr(r,e,u)},enter:function(e,t){this.actionFun.apply(this,["enter"].concat(avalon.slice(arguments)))},leave:function(e,t){this.actionFun.apply(this,["leave"].concat(avalon.slice(arguments)))},dispose:function(){this.update=this.cssCallback=null,br.unshift(this)>100&&br.pop()}};var kr=function(e,t){var n=y.call(arguments,0);typeof n[2]!="function"&&n.splice(2,0,N),typeof n[3]!="function"&&n.splice(3,0,N);var r=n[2],i=n[3],s=n[4],o=wr(e,s);if(!o)return r(),i(),!1;var u=t?"enter":"leave";o[u](r,i)};avalon.mix(avalon.effect,{apply:kr,append:function(e,t,n,r){return kr(e,1,function(){t.appendChild(e)},n,r)},before:function(e,t,n,r){return kr(e,1,function(){t.parentNode.insertBefore(e,t)},n,r)},remove:function(e,t,n,r){return kr(e,0,function(){e.parentNode===t&&t.removeChild(e)},n,r)}}),avalon.directive("html",{update:function(e){var n=this,r=this.element,i=r.nodeType!==1,s=i?r.parentNode:r;if(!s)return;e=e==null?"":e;if(r.nodeType===3){var o=k("html");s.insertBefore(t.createComment(o),r),n.element=t.createComment(o+":end"),s.replaceChild(n.element,r),r=n.element}if(typeof e!="object")var u=avalon.parseHTML(String(e));else if(e.nodeType===11)u=e;else if(e.nodeType===1||e.item){var a=e.nodeType===1?e.childNodes:e.item;u=E.cloneNode(!0);while(a[0])u.appendChild(a[0])}a=avalon.slice(u.childNodes);if(i){var f=r.nodeValue.slice(0,-4);for(;;){var l=r.previousSibling;if(!l||l.nodeType===8&&l.nodeValue===f)break;s.removeChild(l)}s.insertBefore(u,r)}else avalon.clearHTML(r).appendChild(u);Bn(a,n.vmodels)}}),avalon.directive("if",{priority:10,update:function(e){var n=this,i=this.element,s=n.stamp=+(new Date),o,u=function(){if(s!==n.stamp)return;n.recoverNode=null};n.recoverNode&&n.recoverNode();try{if(!i.parentNode)return;o=i.parentNode}catch(a){return}if(e){function f(){i.getAttribute(n.name)&&(i.removeAttribute(n.name),On(i,n.vmodels)),n.rollback=null}if(i.nodeType===8){var l=n.keep,c=avalon.effect.apply(l,1,function(){if(s!==n.stamp)return;i.parentNode.replaceChild(l,i),i=n.element=l,l.getAttribute("_required")&&(i.required=!0,i.removeAttribute("_required")),i.querySelectorAll&&avalon.each(i.querySelectorAll("[_required=true]"),function(e){e.required=!0,e.removeAttribute("_required")}),f()},u);c=c===!1}c||f()}else if(i.nodeType===1){i.required===!0&&(i.required=!1,i.setAttribute("_required","true"));try{avalon.each(i.querySelectorAll(":required"),function(e){i.required=!1,e.setAttribute("_required","true")})}catch(a){}var h=n.element=t.createComment("ms-if"),p=i.nextSibling;n.recoverNode=function(){n.recoverNode=null,h.parentNode!==o&&(o.insertBefore(h,p),n.keep=i)},avalon.effect.apply(i,0,function(){n.recoverNode=null;if(s!==n.stamp)return;i.parentNode.replaceChild(h,i),n.keep=i,r.appendChild(i),n.rollback=function(){i.parentNode===r&&r.removeChild(i)}},u)}}});var Lr=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,Ar=/<noscript.*?>([\s\S]+?)<\/noscript>/im,Or=function(){return new window.XMLHttpRequest},Mr=avalon.templateCache={};avalon.directive("include",{init:P.attr.init,update:function(e){var n=this,s=this.element,o=n.vmodels,u=n.includeRendered,a=n.effectName&&n.effectClass,f=n.templateCache,l=n.includeReplace,c=n.includeLoaded,h=l?s.parentNode:s,p=n._element;n.recoverNodes=n.recoverNodes||avalon.noop;var d=function(i){var d=n._stamp=+(new Date);if(c){var v=c.apply(h,[i].concat(o));typeof v=="string"&&(i=v)}u&&wn(h,function(){u.call(h)},NaN);var m=n.includeLastID||"_default";n.includeLastID=e;var g=f&&f[m]||t.createElement(s.tagName||n._element.tagName);a&&(g.className=a,h.insertBefore(g,n.start)),(f||{})[m]=g;var y=n.recoverNodes();y&&h.insertBefore(y,n.end);for(;;){var b=n.start.nextSibling;if(!b||b===g||b===n.end)break;g.appendChild(b)}avalon.effect.remove(g,h,function(){f&&d===n._stamp&&r.appendChild(g)},n);var w=h,E=avalon.noop,S=avalon.noop,x=_r(n,e,i),T=avalon.slice(x.childNodes);l&&a?(w=p,w.innerHTML="",w.setAttribute("ms-skip","true"),h.insertBefore(w,n.end.nextSibling),E=function(){w.insertBefore(x,null)},S=function(){n.recoverNodes=avalon.noop,d===n._stamp&&(x=Dr(T),h.insertBefore(x,n.end),Bn(T,o)),w.parentNode===h&&h.removeChild(w)},n.recoverNodes=function(){return n.recoverNodes=avalon.noop,Dr(T)}):E=function(){h.insertBefore(x,n.end),Bn(T,o)},avalon.effect.apply(w,"enter",E,S)};if(n.param==="src")if(typeof Mr[e]=="string")avalon.nextTick(function(){d(Mr[e])});else if(Array.isArray(Mr[e]))Mr[e].push(d);else{var v=Or();v.onload=function(){var t=v.responseText;for(var n=0,r;r=Mr[e][n++];)r(t);Mr[e]=t},v.onerror=function(){i("ms-include load ["+e+"] error")},Mr[e]=[d],v.open("GET",e,!0),"withCredentials"in v&&(v.withCredentials=!0),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.send(null)}else{var m=e&&e.nodeType===1?e:t.getElementById(e);m&&avalon.nextTick(function(){d(m.value||m.innerText||m.innerHTML)})}}});var Pr=/\(([^)]*)\)/,Hr=avalon.directive("on",{priority:3e3,init:function(e){var t=e.expr;e.type="on";var n=e.param.replace(/-\d+$/,"");typeof Hr[n+"Hook"]=="function"&&Hr[n+"Hook"](e);if(t.indexOf("(")>0&&t.indexOf(")")>-1){var r=(t.match(Pr)||["",""])[1].trim();if(r===""||r==="$event")t=t.replace(Pr,"")}e.expr=t},update:function(e){var t=this,n=this.element;e=function(e){var n=t.getter||N;return n.apply(this,t.args.concat(e))};var r=t.param.replace(/-\d+$/,"");if(r==="scan")e.call(n,{type:r});else if(typeof t.specialBind=="function")t.specialBind(n,e);else var i=avalon.bind(n,r,e);t.rollback=function(){typeof t.specialUnbind=="function"?t.specialUnbind():avalon.unbind(n,r,i)}}});avalon.directive("repeat",{priority:90,init:function(e){var n=e.type;e.cache={},e.enterCount=0;var r=e.element;if(r.nodeType===1){r.removeAttribute(e.name),Er(r,e),e.param=e.param||"el",e.sortedCallback=Sn(r,"data-with-sorted",e.vmodels);var i=Sn(r,"data-"+n+"-rendered",e.vmodels),s=k(n),o=t.createComment(s+":start"),u=e.element=t.createComment(s+":end");e.signature=s,e.start=o,e.template=E.cloneNode(!1);if(n==="repeat"){var a=r.parentNode;a.replaceChild(u,r),a.insertBefore(o,u),e.template.appendChild(r)}else{while(r.firstChild)e.template.appendChild(r.firstChild);r.appendChild(o),r.appendChild(u),a=r}e.element=u;if(i)var f=avalon.bind(a,"datasetchanged",function(){i.apply(a,a.args),avalon.unbind(a,"datasetchanged",f),a.msRendered=i})}},update:function(e,t){var n=this,r=this.xtype;this.enterCount+=1;var i=!t;if(i){n.$outer={};var s="$key",o="$val";r==="array"&&(s="$first",o="$last");for(var u=0,a;a=n.vmodels[u++];)if(a.hasOwnProperty(s)&&a.hasOwnProperty(o)){n.$outer=a;break}}var f=this.track;if(n.sortedCallback){var l=n.sortedCallback.call(b,f);l&&Array.isArray(l)&&(f=l)}var c="move";n.$repeat=e;var h=[],p=i&&E.cloneNode(!1),d=[],v=this.param,m=avalon.mix({},this.cache),g=this.element,y=f.length,b=g.parentNode;for(u=0;u<y;u++){var w=f[u],S=m[w];if(!S){S=qr(this),r==="array"?(c="add",S.$id=w,S[v]=e[u]):(c="append",S.$key=w,S.$val=e[w]),this.cache[w]=S;var x=S.$anchor||(S.$anchor=g.cloneNode(!1));x.nodeValue=this.signature,Ir(n,p,S,h,i&&!n.effectDriver),Wr(S,n,r)}else h.push({}),m[w]=!0;this.enterCount===1&&(S.$active=!1,S.$oldIndex=S.$index,S.$active=!0,S.$index=u),r==="array"?(S.$first=u===0,S.$last=u===y-1):S.$val=lt(e[w]),d.push(S)}this.proxies=d;if(i&&!n.effectDriver)b.insertBefore(p,g),h.forEach(function(e){Bn(e.nodes||[],e.vmodels),e.nodes=e.vmodels=null});else{var T=n.staggerIndex=0;for(w in m)m[w]!==!0&&(c="del",Fr(m[w].$anchor,n),Jr(this.cache,w,v),m[w]=null);for(u=0;u<y;u++){S=d[u],w=r==="array"?S.$id:S.$key;var N=d[u-1],C=N?N.$anchor:n.start;m[w]?S.$index!==S.$oldIndex&&function(e,t){T=jr(n.effectEnterStagger,function(){var r=Fr(e.$anchor),i=avalon.slice(r.childNodes);b.insertBefore(r,t.nextSibling),Br(i,1,n)},T)}(S,C):function(e,t){var r=e.nodes,i=e.vmodels;r&&(T=jr(n.effectEnterStagger,function(){b.insertBefore(e.content,t.nextSibling),Bn(r,i),Br(r,1,n)},T)),e.nodes=e.vmodels=null}(h[u],C)}}if(!e.$track)for(w in this.cache)Jr(this.cache,w,v);(function(e){b.args=e,b.msRendered&&b.msRendered.apply(b,e)})(R.newWatch?arguments:[c]);var k=setTimeout(function(){clearTimeout(k),avalon.fireDom(b,"datasetchanged",{bubble:b.msHasEvent})});this.enterCount-=1}}),"with,each".replace(f,function(e){P[e]=avalon.mix({},P.repeat,{priority:1400})});var Rr=[],Xr=[];avalon.directive("text",{update:function(e){var t=this.element;e=e==null?"":e;if(t.nodeType===3)try{t.data=e}catch(n){}else t.textContent=e}}),avalon.parseDisplay=Kr,avalon.directive("visible",{init:function(e){},update:function(e){var t=this.element,n=this,r=n.stamp=+(new Date);e?(t.style.display="none",avalon.effect.apply(t,1,function(){if(r!==n.stamp)return;var e=t.getAttribute("data-effect-driver")||"a";/^[atn]/.test(e)&&(this.effectName||(t.style.display=""),avalon(t).css("display")==="none"&&(t.style.display=Kr(t.nodeName)))})):avalon.effect.apply(t,0,function(){if(r!==n.stamp)return;t.style.display="none"})}});var Qr=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,Gr=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,Yr=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,Zr={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},ei=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,ti=/([^\#-~| |!])/g,ri=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n=typeof n=="string"?n:"...",e.length>t?e.slice(0,t-n.length)+n:String(e)},$filter:function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t],i=avalon.filters[r[0]];if(typeof i=="function"){var s=[e].concat(r.slice(1));e=i.apply(null,s)}}return e},camelize:qt,sanitize:function(e){return e.replace(Qr,"").replace(Yr,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=Zr[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(Gr," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(ei,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(ti,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}};return avalon});