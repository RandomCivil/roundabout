define("avalon-min",function(){function log(){window.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}function noop(){}function oneObject(e,t){typeof e=="string"&&(e=e.match(rword)||[]);var n={},r=t!==void 0?t:1;for(var i=0,s=e.length;i<s;i++)n[e[i]]=r;return n}function IE(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return NaN}function isWindow(e){return rwindow.test(serialize.call(e))}function _number(e,t){return e=Math.floor(e)||0,e<0?Math.max(t+e,0):Math.min(e,t)}function isArrayLike(e){if(!e)return!1;var t=e.length;if(t===t>>>0){var n=serialize.call(e).slice(8,-1);if(/(?:regexp|string|function|window|global)$/i.test(n))return!1;if(n==="Array")return!0;try{return{}.propertyIsEnumerable.call(e,"length")===!1?/^\s?function/.test(e.item||e.callee):!0}catch(r){return!e.window}}return!1}function iterator(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function fixContains(e,t){try{while(t=t.parentNode)if(t===e)return!0;return!1}catch(n){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function fixEvent(e){var t={};for(var n in e)t[n]=e[n];var r=t.target=e.srcElement;if(e.type.indexOf("key")===0)t.which=e.charCode!=null?e.charCode:e.keyCode;else if(rmouseEvent.test(e.type)){var i=r.ownerDocument||DOC,s=i.compatMode==="BackCompat"?i.body:i.documentElement;t.pageX=e.clientX+(s.scrollLeft>>0)-(s.clientLeft>>0),t.pageY=e.clientY+(s.scrollTop>>0)-(s.clientTop>>0),t.wheelDeltaY=t.wheelDelta,t.wheelDeltaX=0}return t.timeStamp=new Date-0,t.originalEvent=e,t.preventDefault=function(){e.returnValue=!1},t.stopPropagation=function(){e.cancelBubble=!0},t}function kernel(e){for(var t in e){if(!ohasOwn.call(e,t))continue;var n=e[t];typeof kernel.plugins[t]=="function"?kernel.plugins[t](n):typeof kernel[t]=="object"?avalon.mix(kernel[t],n):kernel[t]=n}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function modelFactory(e,t,n){if(Array.isArray(e)){var r=e.concat();e.length=0;var i=arrayFactory(e);return i.pushArray(r),i}if(!e||e.nodeType>0||e.$id&&e.$events)return e;var s=Array.isArray(e.$skipArray)?e.$skipArray:[];s.$special=t||{};var o={};n=n||{};var u={},a={},f=[];$$skipArray.forEach(function(t){delete e[t]});var l=Object.keys(e);l.forEach(function(t,r){var i=e[t];n[t]=i;if(isObservable(t,i,s)){u[t]=[];var o=avalon.type(i);o==="object"&&isFunction(i.get)&&Object.keys(i).length<=2?(r=makeComputedAccessor(t,i),f.push(r)):rcomplexType.test(o)?r=makeComplexAccessor(t,i,o,u[t],n):r=makeSimpleAccessor(t,i),a[t]=r}}),o=defineProperties(o,descriptorFactory(a),e);for(var c=0;c<l.length;c++){var h=l[c];a[h]||(o[h]=e[h])}hideProperty(o,"$id",generateID()),hideProperty(o,"$model",n),hideProperty(o,"$events",u),canHideOwn?hideProperty(o,"hasOwnProperty",function(e){return e in o.$model}):o.hasOwnProperty=function(e){return e in o.$model&&e!=="hasOwnProperty"};for(c in EventBus)hideProperty(o,c,EventBus[c].bind(o));return o.$reinitialize=function(){f.forEach(function(e){delete e._value,delete e.oldArgs,e.digest=function(){e.call(o)},dependencyDetection.begin({callback:function(t,n){var r=n._name;if(n!==e){var i=t.$events[r];injectDependency(i,e.digest)}}});try{e.get.call(o)}finally{dependencyDetection.end()}})},o.$reinitialize(),o}function hideProperty(e,t,n){canHideOwn?Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0}):e[t]=n}function makeSimpleAccessor(e,t){function n(e){var t=n._value;return arguments.length>0?(!stopRepeatAssign&&!isEqual(e,t)&&(n.updateValue(this,e),n.notify(this,e,t)),this):(dependencyDetection.collectDependency(this,n),t)}return accessorFactory(n,e),n._value=t,n}function makeComputedAccessor(e,t){function n(t){var r=n._value,i="_value"in n;if(arguments.length>0){if(stopRepeatAssign)return this;if(typeof n.set=="function"&&n.oldArgs!==t){n.oldArgs=t;var s=this.$events,o=s[e];s[e]=[],n.set.call(this,t),s[e]=o,t=n.get.call(this),t!==r&&(n.updateValue(this,t),n.notify(this,t,r))}return this}return t=n.get.call(this),n.updateValue(this,t),i&&r!==t&&n.notify(this,t,r),t}return n.set=t.set,n.get=t.get,accessorFactory(n,e),n}function makeComplexAccessor(e,t,n,r,i){function s(t){var r=s._value,i=s._vmodel;if(arguments.length>0){if(stopRepeatAssign)return this;if(n==="array"){var o=i,u=t,a=o.length,f=u.length;o.$lock=!0,a>f?o.splice(f,a-f):f>a&&o.push.apply(o,u.slice(a));var l=Math.min(a,f);for(var c=0;c<l;c++)o.set(c,u[c]);delete o.$lock,o._fire("set")}else if(n==="object"){var h=this.$events[e]||[],p=avalon.mix(!0,{},t);for(c in i)i.hasOwnProperty(c)&&ohasOwn.call(p,c)&&(i[c]=p[c]);i=s._vmodel=modelFactory(t),i.$events[subscribers]=h,h.length&&h.forEach(function(e){if(!e.type)return;e.rollback&&e.rollback(),bindingHandlers[e.type](e,e.vmodels)})}return s.updateValue(this,i.$model),s.notify(this,this._value,r),this}return dependencyDetection.collectDependency(this,s),i}accessorFactory(s,e),Array.isArray(t)?i[e]=t:i[e]=i[e]||{};var o=s._vmodel=modelFactory(t,0,i[e]);return o.$events[subscribers]=r,s}function globalUpdateValue(e,t){e.$model[this._name]=this._value=t}function globalNotify(e,t,n){var r=this._name,i=e.$events[r];i&&(fireDependencies(i),EventBus.$fire.call(e,r,t,n))}function accessorFactory(e,t){e._name=t,e.updateValue=globalUpdateValue,e.notify=globalNotify}function isObservable(e,t,n){if(isFunction(t)||t&&t.nodeType)return!1;if(n.indexOf(e)!==-1)return!1;var r=n.$special;return e&&e.charAt(0)==="$"&&!r[e]?!1:!0}function keysVM(e){var t=Object.keys(e.$model?e.$model:e);for(var n=0;n<$$skipArray.length;n++){var r=t.indexOf($$skipArray[n]);r!==-1&&t.splice(r,1)}return t}function arrayFactory(e){var t=[];t.$id=generateID(),t.$model=e,t.$events={},t.$events[subscribers]=[],t._=modelFactory({length:e.length}),t._.$watch("length",function(e,n){t.$fire("length",e,n)});for(var n in EventBus)t[n]=EventBus[n];return avalon.mix(t,arrayPrototype),t}function mutateArray(e,t,n,r,i,s,o){var u=this.length,a=2;while(--a){switch(e){case"add":var f=this.$model.slice(t,t+n).map(function(e){return rcomplexType.test(avalon.type(e))?e.$id?e:modelFactory(e,0,e):e});_splice.apply(this,[t,0].concat(f)),this._fire("add",t,n);break;case"del":var l=this._splice(t,n);this._fire("del",t,n)}i&&(e=i,t=s,n=o,a=2,i=0)}return this._fire("index",r),this.length!==u&&(this._.length=this.length),l}function resetIndex(e,t){var n=e.length-1;for(var r;r=e[t];t++)r.$index=t,r.$first=t===0,r.$last=t===n}function sortByIndex(e,t){var n={};for(var r=0,i=t.length;r<i;r++){n[r]=e[r];var s=t[r];s in n?(e[r]=n[s],delete n[s]):e[r]=e[s]}}function injectDependency(e,t){if(t.oneTime)return;e&&avalon.Array.ensure(e,t)&&t.element&&(injectDisposeQueue(t,e),new Date-beginTime>444&&rejectDisposeQueue())}function fireDependencies(e){if(e&&e.length){new Date-beginTime>444&&typeof e[0]=="object"&&rejectDisposeQueue();var t=aslice.call(arguments,1);for(var n=e.length,r;r=e[--n];){var i=r.element;if(i&&i.parentNode)try{var s=r.evaluator;if(r.$repeat)r.handler.apply(r,t);else if("$repeat"in r||!s)bindingHandlers[r.type](r,r.vmodels);else if(r.type!=="on"){var o=s.apply(0,r.args||[]);r.handler(o,i,r)}}catch(u){console.log(u)}}}}function getUid(e,t){return!e.uuid&&!t&&(e.uuid=++disposeCount),e.uuid}function injectDisposeQueue(e,t){var n=e.element;e.uuid||(n.nodeType!==1?e.uuid=e.type+(e.pos||0)+"-"+getUid(n.parentNode):e.uuid=e.name+"-"+getUid(n));var r=e.lists||(e.lists=[]);avalon.Array.ensure(r,t),t.$uuid=t.$uuid||generateID(),disposeQueue[e.uuid]||(disposeQueue[e.uuid]=1,disposeQueue.push(e))}function rejectDisposeQueue(e){if(avalon.optimize)return;var t=disposeQueue.length,n=t,r=[],i={},s={};while(e=disposeQueue[--t]){var o=e.type;s[o]?s[o]++:(s[o]=1,r.push(o))}var u=!1;r.forEach(function(e){oldInfo[e]!==s[e]&&(i[e]=1,u=!0)}),t=n;if(u)while(e=disposeQueue[--t]){if(e.element===null){disposeQueue.splice(t,1);continue}if(i[e.type]&&shouldDispose(e.element)){disposeQueue.splice(t,1),delete disposeQueue[e.uuid];var a=e.lists;for(var f=0,l;l=a[f++];)avalon.Array.remove(a,l),avalon.Array.remove(l,e);disposeData(e)}}oldInfo=s,beginTime=new Date}function disposeData(e){delete disposeQueue[e.uuid],e.element=null,e.rollback&&e.rollback();for(var t in e)e[t]=null}function shouldDispose(e){try{var t=e.parentNode.nodeType}catch(n){return!0}return e.ifRemove&&!root.contains(e.ifRemove)&&ifGroup===e.parentNode?(e.parentNode&&e.parentNode.removeChild(e),!0):e.msRetain?0:e.nodeType===1?!root.contains(e):!avalon.contains(root,e)}function isVML(e){var t=e.nodeName;return t.toLowerCase()===t&&e.scopeName&&e.outerText===""}function fixVML(e){e.currentStyle.behavior!=="url(#default#VML)"&&(e.style.behavior="url(#default#VML)",e.style.display="inline-block",e.style.zoom=1)}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function fakeClassList(e){if(!("classList"in e)){e.classList={node:e};for(var t in fakeClassListMethods)e.classList[t.slice(1)]=fakeClassListMethods[t]}return e.classList}function parseData(e){try{if(typeof e=="object")return e;e=e==="true"?!0:e==="false"?!1:e==="null"?null:+e+""===e?+e:rbrace.test(e)?avalon.parseJSON(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function showHidden(e,t){if(e.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](e,"display"))){var n={node:e};for(var r in cssShow)n[r]=e.style[r],e.style[r]=cssShow[r];t.push(n)}var i=e.parentNode;i&&i.nodeType===1&&showHidden(i,t)}}function getValType(e){var t=e.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(e.type)?"checked":t}function addAssign(e,t,n,r){var i=[],s=" = "+n+".";for(var o=e.length,u;u=e[--o];)t.hasOwnProperty(u)&&(i.push(u+s+u),r.vars.push(u),r.type==="duplex"&&(e.get=n+"."+u),e.splice(o,1));return i}function uniqSet(e){var t=[],n={};for(var r=0;r<e.length;r++){var i=e[r],s=i&&typeof i.$id=="string"?i.$id:i;n[s]||(n[s]=t.push(i))}return t}function parseFilter(e,t){return t=t.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(e,t){return"["+quote(t)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]","return this.filters.$filter("+e+", "+t+")"}function parseExpr(e,t,n){var r=n.type,i=n.filters||"",s=t.map(function(e){return String(e.$id).replace(rproxy,"$1")})+e+r+i,o=getVariables(e).concat(),u=[],a=[],f=[],l="";t=uniqSet(t),n.vars=[];for(var c=0,h=t.length;c<h;c++)if(o.length){var p="vm"+expose+"_"+c;a.push(p),f.push(t[c]),u.push.apply(u,addAssign(o,t[c],p,n))}if(!u.length&&r==="duplex")return;r!=="duplex"&&(e.indexOf("||")>-1||e.indexOf("&&")>-1)&&n.vars.forEach(function(t){var n=new RegExp("\\b"+t+"(?:\\.\\w+|\\[\\w+\\])+","ig");e=e.replace(n,function(n,r){var i=n.charAt(t.length),s=e.slice(r+n.length),o=/^\s*\(/.test(s);if(i==="."||i==="["||o){var a="var"+String(Math.random()).replace(/^0\./,"");if(o){var f=n.split(".");if(f.length>2){var l=f.pop();return u.push(a+" = "+f.join(".")),a+"."+l}return n}return u.push(a+" = "+n),a}return n})}),n.args=f,delete n.vars;var d=evaluatorPool.get(s);if(d){n.evaluator=d;return}l=u.join(", "),l&&(l="var "+l);if(/\S/.test(i)){if(!/text|html/.test(n.type))throw Error("ms-"+n.type+"不支持过滤器");e="\nvar ret"+expose+" = "+e+";\r\n",e+=parseFilter("ret"+expose,i);try{d=Function.apply(noop,a.concat("'use strict';\n"+l+e)),n.evaluator=evaluatorPool.put(s,function(){return d.apply(avalon,arguments)})}catch(v){log("debug: parse error,"+v.message)}o=u=a=null;return}if(r==="duplex"){var m="'use strict';\nreturn function(vvv){\n	"+l+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:o.get)+"= vvv;\n} ";try{d=Function.apply(noop,a.concat(m)),n.evaluator=evaluatorPool.put(s,d)}catch(v){log("debug: parse error,"+v.message)}o=u=a=null;return}if(r==="on"){e.indexOf("(")===-1?e+=".call(this, $event)":e=e.replace("(",".call(this,"),a.push("$event"),e="\nreturn "+e+";";var g=e.lastIndexOf("\nreturn"),y=e.slice(0,g),b=e.slice(g);e=y+"\n"+b}else e="\nreturn "+e+";";try{d=Function.apply(noop,a.concat("'use strict';\n"+l+e)),n.evaluator=evaluatorPool.put(s,d)}catch(v){log("debug: parse error,"+v.message)}o=u=a=null}function stringifyExpr(e){var t=rexpr.test(e);if(t){var n=scanExpr(e);return n.length===1?n[0].value:n.map(function(e){return e.expr?"("+e.value+")":quote(e.value)}).join(" + ")}return e}function parseExprProxy(e,t,n,r){e=e||"",parseExpr(e,t,n),n.evaluator&&!r&&(n.handler=bindingExecutors[n.handlerName||n.type],avalon.injectBinding(n))}function checkScan(e,t,n){var r=setTimeout(function(){var i=e.innerHTML;clearTimeout(r),i===n?t():checkScan(e,t,i)})}function createSignalTower(e,t){var n=e.getAttribute("avalonctrl")||t.$id;e.setAttribute("avalonctrl",n),t.$events.expr=e.tagName+'[avalonctrl="'+n+'"]'}function executeBindings(e,t){for(var n=0,r;r=e[n++];)r.vmodels=t,bindingHandlers[r.type](r,t),r.evaluator&&r.element&&r.element.nodeType===1&&r.element.removeAttribute(r.name);e.length=0}function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(e,t,n){var r=!0;if(t.length){var i=getAttributes?getAttributes(e):e.attributes,s=[],o=[],u={};for(var a=0,f;f=i[a++];)if(f.specified)if(n=f.name.match(rmsAttr)){var l=n[1],c=n[2]||"",h=f.value,p=f.name;events[l]?(c=l,l="on"):obsoleteAttrs[l]&&(l==="enabled"&&(log("warning!ms-enabled或ms-attr-enabled已经被废弃"),l="disabled",h="!("+h+")"),c=l,l="attr",p="ms-"+l+"-"+c,o.push([f.name,p,h])),u[p]=h;if(typeof bindingHandlers[l]=="function"){var d=h.replace(roneTime,""),v=h!==d,m={type:l,param:c,element:e,name:p,value:d,oneTime:v,uuid:p+"-"+getUid(e),priority:(priorityMap[l]||l.charCodeAt(0)*10)+(Number(c.replace(/\D/g,""))||0)};if(l==="html"||l==="text"){var g=getToken(h);avalon.mix(m,g),m.filters=m.filters.replace(rhasHtml,function(){return m.type="html",m.group=1,""})}else if(l==="duplex")var y=p;else p==="ms-if-loop"&&(m.priority+=100);s.push(m),l==="widget"&&(e.msData=e.msData||u)}}if(s.length){s.sort(bindingSorter),o.forEach(function(t){log("warning!请改用"+t[1]+"代替"+t[0]+"!"),e.removeAttribute(t[0]),e.setAttribute(t[1],t[2])}),y&&u["ms-attr-value"]&&!e.scopeName&&e.type==="text"&&log("warning!一个控件不能同时定义ms-attr-value与"+y);for(a=0;m=s[a];a++){l=m.type;if(rnoscanAttrBinding.test(l))return executeBindings(s.slice(0,a+1),t);r&&(r=!rnoscanNodeBinding.test(l))}executeBindings(s,t)}}r&&!stopScan[e.tagName]&&rbind.test(e.innerHTML.replace(rlt,"<").replace(rgt,">"))&&(mergeTextNodes&&mergeTextNodes(e),scanNodeList(e,t))}function scanNodeList(e,t){var n=avalon.slice(e.childNodes);scanNodeArray(n,t)}function scanNodeArray(e,t){for(var n=0,r;r=e[n++];)switch(r.nodeType){case 1:scanTag(r,t),r.msCallback&&(r.msCallback(),r.msCallback=void 0);break;case 3:rexpr.test(r.nodeValue)&&scanText(r,t,n)}}function scanTag(e,t,n){var r=e.getAttribute("ms-skip");if(!e.getAttributeNode)return log("warning "+e.tagName+" no getAttributeNode method");var i=e.getAttributeNode("ms-important"),s=e.getAttributeNode("ms-controller");if(typeof r=="string")return;if(n=i||s){var o=avalon.vmodels[n.value];if(!o)return;t=n===i?[o]:[o].concat(t);var u=n.name;e.removeAttribute(u),avalon(e).removeClass(u),createSignalTower(e,o)}scanAttr(e,t)}function getToken(e){if(e.indexOf("|")>0){var t=e.replace(rstringLiteral,function(e){return Array(e.length+1).join("1")}),n=t.replace(r11a,"ᄢ㍄").indexOf("|");if(n>-1)return{filters:e.slice(n),value:e.slice(0,n),expr:!0}}return{value:e,filters:"",expr:!0}}function scanExpr(e){var t=[],n,r=0,i;do{i=e.indexOf(openTag,r);if(i===-1)break;n=e.slice(r,i),n&&t.push({value:n,filters:"",expr:!1}),r=i+openTag.length,i=e.indexOf(closeTag,r);if(i===-1)break;n=e.slice(r,i),n&&t.push(getToken(n,r)),r=i+closeTag.length}while(1);return n=e.slice(r),n&&t.push({value:n,expr:!1,filters:""}),t}function scanText(e,t,n){var r=[];tokens=scanExpr(e.data);if(tokens.length){for(var i=0;token=tokens[i++];){var s=DOC.createTextNode(token.value);token.expr&&(token.value=token.value.replace(roneTime,function(){return token.oneTime=!0,""}),token.type="text",token.element=s,token.filters=token.filters.replace(rhasHtml,function(e,t,n){return token.type="html",""}),token.pos=n*1e3+i,r.push(token)),avalonFragment.appendChild(s)}e.parentNode.replaceChild(avalonFragment,e),r.length&&executeBindings(r,t)}}function getTemplateNodes(e,t,n){var r=e.templateCache&&e.templateCache[t];if(r){var i=DOC.createDocumentFragment(),s;while(s=r.firstChild)i.appendChild(s);return i}return avalon.parseHTML(n)}function fixNull(e){return e==null?"":e}function pipe(e,t,n,r){return t.param.replace(/\w+/g,function(r){var i=avalon.duplexHooks[r];i&&typeof i[n]=="function"&&(e=i[n](e,t))}),e}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];t()===!1&&ribbon.splice(e,1)}ribbon.length||clearInterval(TimerID)}function shimController(e,t,n,r){var i=e.template.cloneNode(!0),s=avalon.slice(i.childNodes);i.insertBefore(DOC.createComment(e.signature),i.firstChild),t.appendChild(i);var o=[n].concat(e.vmodels),u={nodes:s,vmodels:o};r.push(u)}function getComments(e){var t=[],n=e.element.parentNode.childNodes;for(var r=0,i;i=n[r++];)if(i.nodeValue===e.signature)t.push(i);else if(i.nodeValue===e.signature+":end")break;return t}function sweepNodes(e,t,n){for(;;){var r=t.previousSibling;if(!r)break;r.parentNode.removeChild(r),n&&n.call(r);if(r===e)break}}function withProxyFactory(){var e=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(e){this.$host[this.$key]=e}}},{$val:1});return e.$id=generateID("$proxy$with"),e}function withProxyAgent(e,t,n){e=e||withProxyPool.pop(),e?e.$reinitialize():e=withProxyFactory();var r=n.$repeat;return e.$key=t,e.$host=r,e.$outer=n.$outer,r.$events?e.$events.$val=r.$events[t]:e.$events={},e}function recycleProxies(e){eachProxyRecycler(e)}function eachProxyRecycler(e){e.forEach(function(e){proxyRecycler(e,eachProxyPool)}),e.length=0}function eachProxyFactory(e){var t={$host:[],$outer:{},$index:0,$first:!1,$last:!1,$remove:avalon.noop};t[e]={get:function(){var t=this.$events,n=t.$index;t.$index=t[e];try{return this.$host[this.$index]}finally{t.$index=n}},set:function(e){try{var t=this.$events,n=t.$index;t.$index=[],this.$host.set(this.$index,e)}finally{t.$index=n}}};var n={$last:1,$first:1,$index:1},r=modelFactory(t,n);return r.$id=generateID("$proxy$each"),r}function eachProxyAgent(e,t){var n=t.param||"el",r;for(var i=0,s=eachProxyPool.length;i<s;i++){var o=eachProxyPool[i];o&&o.hasOwnProperty(n)&&(r=o,eachProxyPool.splice(i,1))}r||(r=eachProxyFactory(n));var u=t.$repeat,a=u.length-1;return r.$index=e,r.$first=e===0,r.$last=e===a,r.$host=u,r.$outer=t.$outer,r.$remove=function(){return u.removeAt(r.$index)},r}function proxyRecycler(e,t){for(var n in e.$events){var r=e.$events[n];Array.isArray(r)&&(r.forEach(function(e){typeof e=="object"&&disposeData(e)}),r.length=0)}e.$host=e.$outer={},t.unshift(e)>kernel.maxRepeatSize&&t.pop()}function parseDisplay(e,t){var n="_"+e;if(!parseDisplay[n]){var r=DOC.createElement(e);root.appendChild(r),W3C?t=getComputedStyle(r,null).display:t=r.currentStyle.display,root.removeChild(r),parseDisplay[n]=t}return parseDisplay[n]}function ok(e){return e}function ng(e){throw e}function done(e){return this.then(e,ng)}function fail(e){return this.then(ok,e)}function defer(){var e={};return e.promise=new this(function(t,n){e.resolve=t,e.reject=n}),e}function fireCallbacks(e,t){if(typeof e.async=="boolean")var n=e.async;else n=e.async=!0;n?window.setTimeout(t,0):t()}function _resolve(e,t){if(e._state!=="pending")return;if(t&&typeof t.then=="function"){var n=t instanceof msPromise?"_then":"then";t[n](function(t){_transmit(e,t,!0)},function(t){_transmit(e,t,!1)})}else _transmit(e,t,!0)}function _reject(e,t){if(e._state!=="pending")return;_transmit(e,t,!1)}function _transmit(e,t,n){e._fired=!0,e._value=t,e._state=n?"fulfilled":"rejected",fireCallbacks(e,function(){e._callbacks.forEach(function(t){e._fire(t.onSuccess,t.onFail)})})}function _some(e,t){t=Array.isArray(t)?t:[];var n=0,r=[],i;return new msPromise(function(s,o){function u(u,a){u.then(function(o){if(!i){r[a]=o,n++;if(e||n>=t.length)s(e?o:r),i=!0}},function(e){i=!0,o(e)})}t.length||s();for(var a=0,f=t.length;a<f;a++)u(t[a],a)})}function IE(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return 0}function parseJS(code){var indirect=eval;code=code.trim();if(code)if(code.indexOf("use strict")===1){var script=document.createElement("script");script.text=code,head.appendChild(script).parentNode.removeChild(script)}else indirect(code)}function parseXML(e,t,n){try{var r=document.documentMode;window.DOMParser&&(!r||r>8)?(n=new DOMParser,t=n.parseFromString(e,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e))}catch(i){t=void 0}return(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)&&avalon.error("Invalid XML: "+e),t}function ajaxExtend(e){e=avalon.mix({},defaults,e),e.type=e.type.toUpperCase();var t=typeof e.data=="string"?e.data:avalon.param(e.data);e.querystring=t||"",e.url=e.url.replace(rhash,"").replace(rprotocol,location.protocol+"//");if(typeof e.crossDomain!="boolean"){var n=document.createElement("a");try{n.href=e.url;var r="1"[0]?n.href:n.getAttribute("href",4);n.href=r,e.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=n.protocol+"//"+n.host}catch(i){e.crossDomain=!0}}return e.hasContent=!rnoContent.test(e.type),e.hasContent||(t&&(e.url+=(rquery.test(e.url)?"&":"?")+t),e.cache===!1&&(e.url+=(rquery.test(e.url)?"&":"?")+"_time="+(new Date-0))),e}function ok(e){return e}function ng(e){throw e}function paramInner(e,t,n){var r;if(Array.isArray(t))avalon.each(t,function(t,r){rbracket.test(e)?n(e,r):paramInner(e+"["+(typeof r=="object"?t:"")+"]",r,n)});else if(avalon.isPlainObject(t))for(r in t)paramInner(e+"["+r+"]",t[r],n);else n(e,t)}function tryDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){return e}}function addSubObject(e,t,n){var r=t.match(r5b5d);if(!r)return!0;var i=[],s=!0,o,u,a;while(u=t.lastIndexOf("%5B")){if(u===-1)break;a=t.slice(u).slice(3,-3),t=t.slice(0,u),a===""?i.unshift({action:"pushArrayElement"}):(a>>>0)+""===a?i.unshift({action:"setSubArray",value:a}):s?i.unshift({action:"setObjectProperty",value:tryDecodeURIComponent(a)}):i.unshift({action:"setSubObjet",value:tryDecodeURIComponent(a)}),s=!1}s=!0;while(o=i.shift()){var f=/Object/.test(o.action);s&&(t in e||(e[t]=f?{}:[]),s=!1,e=e[t]);switch(o.action){case"pushArrayElement":e.push(n);break;case"setObjectProperty":e[o.value]=n;break;case"setSubObjet":o.value in e||(e[o.value]={}),e=e[o.value];break;case"setSubArray":o.value in e||(e[o.value]=[]),e=e[o.value]}}}function trimLine(e){return e.replace(rline,"\r\n")}var expose=new Date-0,DOC=window.document,head=DOC.getElementsByTagName("head")[0],ifGroup=head.insertBefore(document.createElement("avalon"),head.firstChild);ifGroup.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>",ifGroup.setAttribute("ms-skip","1"),ifGroup.className="avalonHide";var rnative=/\[native code\]/,subscribers="$"+expose,otherRequire=window.require,otherDefine=window.define,innerRequire,stopRepeatAssign=!1,rword=/[^, ]+/g,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,avalonFragment=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()});var generateID=function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,e)},IEVersion=IE();avalon=function(e){return new avalon.init(e)},avalon.profile=function(){window.console&&avalon.config.profile&&Function.apply.call(console.log,console,arguments)},avalon.nextTick=new function(){function r(){var e=n.length;for(var t=0;t<e;t++)n[t]();n=n.slice(e)}var e=window.setImmediate,t=window.MutationObserver;if(e)return e.bind(window);var n=[];if(t){var i=document.createTextNode("avalon");return(new t(r)).observe(i,{characterData:!0}),function(e){n.push(e),i.data=Math.random()}}return window.VBArray?function(e){n.push(e);var t=DOC.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,head.removeChild(t),t=null},head.appendChild(t)}:function(e){setTimeout(e,4)}},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[serialize.call(e)]||"object":typeof e};var isFunction=typeof alert=="object"?function(e){try{return/^\s*\bfunction\b/.test(e+"")}catch(t){return!1}}:function(e){return serialize.call(e)==="[object Function]"};avalon.isFunction=isFunction,avalon.isWindow=function(e){return e?e==e.document&&e.document!=e:!1},isWindow(window)&&(avalon.isWindow=isWindow);var enu;for(enu in avalon({}))break;var enumerateBUG=enu!=="0";avalon.isPlainObject=function(e,t){if(!e||avalon.type(e)!=="object"||e.nodeType||avalon.isWindow(e))return!1;try{if(e.constructor&&!ohasOwn.call(e,"constructor")&&!ohasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(enumerateBUG)for(t in e)return ohasOwn.call(e,t);for(t in e);return t===void 0||ohasOwn.call(e,t)},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return serialize.call(e)==="[object Object]"&&Object.getPrototypeOf(e)===oproto}),avalon.mix=avalon.fn.mix=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u++),typeof o!="object"&&!isFunction(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t];try{r=e[t]}catch(l){continue}if(o===r)continue;f&&r&&(avalon.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&avalon.isPlainObject(n)?n:{},o[t]=avalon.mix(f,s,r)):r!==void 0&&(o[t]=r)}return o},avalon.mix({rword:rword,subscribers:subscribers,version:1.46,ui:{},log:log,slice:W3C?function(e,t,n){return aslice.call(e,t,n)}:function(e,t,n){var r=[],i=e.length;n===void 0&&(n=i);if(typeof n=="number"&&isFinite(n)){t=_number(t,i),n=_number(n,i);for(var s=t;s<n;++s)r[s-t]=e[s]}return r},noop:noop,error:function(e,t){throw(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),t==null&&(t=e||0,e=0);var r=-1,i=Math.max(0,Math.ceil((t-e)/n)),s=new Array(i);while(++r<i)s[r]=e,e+=n;return s},eventHooks:[],bind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t];typeof s=="object"&&(t=s.type,s.deel&&(n=s.deel(e,t,n,r)));var o=W3C?n:function(t){n.call(e,fixEvent(t))};return W3C?e.addEventListener(t,o,!!r):e.attachEvent("on"+t,o),o},unbind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t],o=n||noop;typeof s=="object"&&(t=s.type,s.deel&&(n=s.deel(e,t,n,!1))),W3C?e.removeEventListener(t,o,!!r):e.detachEvent("on"+t,o)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?camelize(t):t,i;t=avalon.cssName(r)||r;if(n===void 0||typeof n=="boolean"){i=cssHooks[r+":get"]||cssHooks["@:get"],t==="background"&&(t="backgroundColor");var s=i(e,t);return n===!0?parseFloat(s)||0:s}if(n==="")e.style[t]="";else{if(n==null||n!==n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),i=cssHooks[r+":set"]||cssHooks["@:set"],i(e,t,n)}},each:function(e,t){if(e){var n=0;if(isArrayLike(e)){for(var r=e.length;n<r;n++)if(t(n,e[n])===!1)break}else for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var i in n)i.indexOf(t)===0&&(r[i.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[i]);return r},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}});var bindingHandlers=avalon.bindingHandlers={},bindingExecutors=avalon.bindingExecutors={},Cache=new function(){function e(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var t=e.prototype;return t.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},t.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0)},t.get=function(e){var t=this._keymap[e];if(t===void 0)return;return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},e};if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;Object.keys||(Object.keys=function(e){var t=[],n=hasProtoEnumBug&&typeof e=="function";if(typeof e=="string"||e&&e.callee)for(var r=0;r<e.length;++r)t.push(String(r));else for(var i in e)(!n||i!=="prototype")&&ohasOwn.call(e,i)&&t.push(String(i));if(hasDontEnumBug){var s=e.constructor,o=s&&s.prototype===e;for(var u=0;u<dontEnumsLength;u++){var a=dontEnums[u];(!o||a!=="constructor")&&ohasOwn.call(e,a)&&t.push(a)}}return t}),Array.isArray||(Array.isArray=function(e){return serialize.call(e)==="[object Array]"}),noop.bind||(Function.prototype.bind=function(e){if(arguments.length<2&&e===void 0)return this;var t=this,n=arguments;return function(){var r=[],i;for(i=1;i<n.length;i++)r.push(n[i]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(e,t){var n=this.length,r=~~t;r<0&&(r+=n);for(;r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=t==null?n-1:t;r<0&&(r=Math.max(0,n+r));for(;r>=0;r--)if(this[r]===e)return r;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),avalon.contains=fixContains,DOC.contains||(DOC.contains=function(e){return fixContains(DOC,e)});if(window.SVGElement){DOC.createTextNode("x").contains||(Node.prototype.contains=function(e){return!!(this.compareDocumentPosition(e)&16)});var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!rsvg.test(svg.firstChild)){function enumerateNode(e,t){if(e&&e.childNodes){var n=e.childNodes;for(var r=0,i;i=n[r++];)if(i.tagName){var s=DOC.createElementNS(svgns,i.tagName.toLowerCase());ap.forEach.call(i.attributes,function(e){s.setAttribute(e.name,e.value)}),enumerateNode(i,s),t.appendChild(s)}}}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if(t==="svg")n.insertBefore(r,this);else{var i=DOC.createDocumentFragment();enumerateNode(r,i),n.insertBefore(i,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}}})}}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var rmouseEvent=/^(?:mouse|contextmenu|drag)|click/,eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,n,r){return function(n){var i=n.relatedTarget;if(!i||i!==t&&!(t.compareDocumentPosition(i)&16))return delete n.type,n.type=e,r.call(t,n)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&
(eventHooks.animationend={type:t})}),"oninput"in DOC.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(e,t,n){return function(t){if(t.propertyName==="value")return t.type="input",n.call(e,t)}}});if(DOC.onmousewheel===void 0){var fixWheelType=DOC.onwheel!==void 0?"wheel":"DOMMouseScroll",fixWheelDelta=fixWheelType==="wheel"?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,deel:function(e,t,n){return function(t){t.wheelDeltaY=t.wheelDelta=t[fixWheelDelta]>0?-120:120,t.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(t,"type",{value:"mousewheel"}),n.call(e,t)}}}}var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(e){var t=innerRequire&&e;window.require=t?innerRequire:otherRequire,window.define=t?innerRequire.define:otherDefine},interpolate:function(e){openTag=e[0],closeTag=e[1];if(openTag===closeTag)throw new SyntaxError("openTag===closeTag");var t=openTag+"test"+closeTag;cinerator.innerHTML=t;if(cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");kernel.openTag=openTag,kernel.closeTag=closeTag,cinerator.innerHTML="";var n=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(n+"(.*?)"+r),rexprg=new RegExp(n+"(.*?)"+r,"g"),rbind=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNodes=DOC.querySelectorAll?function(e){return DOC.querySelectorAll(e)}:function(e){var t=e.match(ravalon),n=DOC.getElementsByTagName(t[1]),r=[];for(var i=0,s;s=n[i++];)s.getAttribute(t[2])===t[3]&&r.push(s);return r},EventBus={$watch:function(e,t){if(typeof t=="function"){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(n===0)this.$watch.backup=this.$events,this.$events={};else if(n===1)this.$events[e]=[];else{var r=this.$events[e]||[],i=r.length;while(~--i<0)if(r[i]===t)return r.splice(i,1)}return this},$fire:function(e){var t,n,r,i;/^(\w+)!(\S+)$/.test(e)&&(t=RegExp.$1,e=RegExp.$2);var s=this.$events;if(!s)return;var o=aslice.call(arguments,1),u=[e].concat(o);if(t==="all")for(n in avalon.vmodels)r=avalon.vmodels[n],r!==this&&r.$fire.apply(r,u);else if(t==="up"||t==="down"){var a=s.expr?findNodes(s.expr):[];if(a.length===0)return;for(n in avalon.vmodels){r=avalon.vmodels[n];if(r!==this&&r.$events.expr){var f=findNodes(r.$events.expr);if(f.length===0)continue;ap.forEach.call(f,function(e){ap.forEach.call(a,function(n){var i=t==="down"?n.contains(e):e.contains(n);i&&(e._avalon=r)})})}}var l=DOC.getElementsByTagName("*"),c=[];ap.forEach.call(l,function(e){e._avalon&&(c.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),t==="up"&&c.reverse();for(n=0;i=c[n++];)if(i.$fire.apply(i,u)===!1)break}else{var h=s[e]||[],p=s.$all||[];for(n=0;i=h[n++];)isFunction(i)&&i.apply(this,o);for(n=0;i=p[n++];)isFunction(i)&&i.apply(this,arguments)}}},VMODELS=avalon.vmodels={};avalon.define=function(e,t){var n=e.$id||e;n||log("warning: vm必须指定$id"),VMODELS[n]&&log("warning: "+n+" 已经存在于avalon.vmodels中");if(typeof e=="object")var r=modelFactory(e);else{var i={$watch:noop};t(i),r=modelFactory(i),stopRepeatAssign=!0,t(r),stopRepeatAssign=!1}return r.$id=n,VMODELS[n]=r};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$reinitialize").match(rword),defineProperty=Object.defineProperty,canHideOwn=!0;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){canHideOwn=!1}var isEqual=Object.is||function(e,t){return e===0&&t===0?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=W3C?function(e){var t={};for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t}:function(e){return e};if(!canHideOwn){"__defineGetter__"in avalon&&(defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&defineProperty(e,n,t[n]);return e});if(IEVersion){var VBClassPool={};window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript");function VBMediator(e,t,n,r){var i=t[n];if(arguments.length!==4)return i.call(e);i.call(e,r)}defineProperties=function(e,t,n){var r=[];r.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d"+expose+", p"+expose+")","		Set [__data__] = d"+expose+": set [__proxy__] = p"+expose,"		Set [__const__] = Me","	End Function");for(e in n)t.hasOwnProperty(e)||r.push("	Public ["+e+"]");$$skipArray.forEach(function(e){t.hasOwnProperty(e)||r.push("	Public ["+e+"]")}),r.push("	Public [hasOwnProperty]");for(e in t)r.push("	Public Property Let ["+e+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Set ["+e+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Get ["+e+"]","	On Error Resume Next","		Set["+e+'] = [__proxy__](Me,[__data__],"'+e+'")',"	If Err.Number <> 0 Then","		["+e+'] = [__proxy__](Me,[__data__],"'+e+'")',"	End If","	On Error Goto 0","	End Property");r.push("End Class");var i=r.join("\r\n"),s=VBClassPool[i];s||(s=generateID("VBClass"),window.parseVB("Class "+s+i),window.parseVB(["Function "+s+"Factory(a, b)","	Dim o","	Set o = (New "+s+")(a, b)","	Set "+s+"Factory = o","End Function"].join("\r\n")),VBClassPool[i]=s);var o=window[s+"Factory"](t,VBMediator);return o}}}var _splice=ap.splice,arrayPrototype={_splice:_splice,_fire:function(e,t,n){fireDependencies(this.$events[subscribers],e,t,n)},size:function(){return this._.length},pushArray:function(e){var t=e.length,n=this.length;return t&&(ap.push.apply(this.$model,e),mutateArray.call(this,"add",n,t,Math.max(0,n-1))),t+n},push:function(){var e=[],t,n=arguments.length;for(t=0;t<n;t++)e[t]=arguments[t];return this.pushArray(e)},unshift:function(){var e=arguments.length,t=this.length;return e&&(ap.unshift.apply(this.$model,arguments),mutateArray.call(this,"add",0,e,0)),e+t},shift:function(){if(this.length){var e=this.$model.shift();return mutateArray.call(this,"del",0,1,0),e}},pop:function(){var e=this.length;if(e){var t=this.$model.pop();return mutateArray.call(this,"del",e-1,1,Math.max(0,e-2)),t}},splice:function(e){var t=arguments.length,n=[],r,i=_splice.apply(this.$model,arguments);return i.length&&(n.push("del",e,i.length,0),r=!0),t>2&&(r?n.splice(3,1,0,"add",e,t-2):n.push("add",e,t-2,0),r=!0),r?mutateArray.apply(this,n):[]},contains:function(e){return this.indexOf(e)!==-1},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?(this.$model.splice(e,1),mutateArray.call(this,"del",e,1,0)):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))for(var t=this.length-1;t>=0;t--)e.indexOf(this[t])!==-1&&this.removeAt(t);else if(typeof e=="function")for(t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&this.removeAt(t)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e<this.length&&e>-1){var n=avalon.type(t);t&&t.$model&&(t=t.$model);var r=this[e];if(n==="object")for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);else n==="array"?r.clear().push.apply(r,t):r!==t&&(this[e]=t,this.$model[e]=t,this._fire("set",e,t))}return this}};"sort,reverse".replace(rword,function(e){arrayPrototype[e]=function(){var t=this.$model,n=t.concat(),r=Math.random(),i=[],s;ap[e].apply(t,arguments);for(var o=0,u=n.length;o<u;o++){var a=t[o],f=n[o];if(isEqual(a,f))i.push(o);else{var l=n.indexOf(a);i.push(l),n[l]=r,s=!0}}return s&&(sortByIndex(this,i),this._fire("move",i),this._fire("index",0)),this}});var dependencyDetection=function(){var e=[],t;return{begin:function(n){e.push(t),t=n},end:function(){t=e.pop()},collectDependency:function(e,n){t&&t.callback(e,n)}}}(),ronduplex=/^(duplex|on)$/;avalon.injectBinding=function(e){var t=e.evaluator;if(t){dependencyDetection.begin({callback:function(t,n){injectDependency(t.$events[n._name],e)}});try{var n=ronduplex.test(e.type)?e:t.apply(0,e.args);n===void 0&&delete e.evaluator,e.handler(n,e.element,e)}catch(r){log("warning:exception throwed in [avalon.injectBinding] ",r),delete e.evaluator;var i=e.element;if(i.nodeType===3){var s=i.parentNode;kernel.commentInterpolate?s.replaceChild(DOC.createComment(e.value),i):i.data=openTag+(e.oneTime?"::":"")+e.value+closeTag}}finally{dependencyDetection.end()}}};var disposeCount=0,disposeQueue=avalon.$$subscribers=[],beginTime=new Date,oldInfo={},tagHooks={area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],col:[2,"<table><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table>","</table>"],td:[3,"<table><tr>","</tr></table>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"</svg>"],_default:W3C?[0,"",""]:[1,"X<div>","</div>"]};tagHooks.th=tagHooks.td,tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(e){tagHooks[e]=tagHooks.g});var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,script=DOC.createElement("script"),rhtml=/<|&#?\w+;/;avalon.parseHTML=function(e){var t=avalonFragment.cloneNode(!1);if(typeof e!="string")return t;if(!rhtml.test(e))return t.appendChild(DOC.createTextNode(e)),t;e=e.replace(rxhtml,"<$1></$2>").trim();var n=(rtagName.exec(e)||["",""])[1].toLowerCase(),r=tagHooks[n]||tagHooks._default,i=cinerator,s,o;W3C||(e=e.replace(rcreate,"<br class=msNoScope>$1")),i.innerHTML=r[1]+e+r[2];var u=i.getElementsByTagName("script");if(u.length)for(var a=0,f;f=u[a++];)scriptTypes[f.type]&&(o=script.cloneNode(!1),ap.forEach.call(f.attributes,function(e){e&&e.specified&&(o[e.name]=e.value,o.setAttribute(e.name,e.value))}),o.text=f.text,f.parentNode.replaceChild(o,f));if(!W3C){var l=r[1]==="X<div>"?i.lastChild.firstChild:i.lastChild;if(l&&l.tagName==="TABLE"&&n!=="tbody")for(u=l.childNodes,a=0;f=u[a++];)if(f.tagName==="TBODY"&&!f.innerHTML){l.removeChild(f);break}u=i.getElementsByTagName("br");var c=u.length;while(f=u[--c])f.className==="msNoScope"&&f.parentNode.removeChild(f);for(u=i.all,a=0;f=u[a++];)isVML(f)&&fixVML(f)}for(a=r[0];a--;i=i.lastChild);while(s=i.firstChild)t.appendChild(s);return t},avalon.innerHTML=function(e,t){if(!W3C&&!rcreate.test(t)&&!rnest.test(t))try{e.innerHTML=t;return}catch(n){}var r=this.parseHTML(t);this.clearHTML(e).appendChild(r)},avalon.clearHTML=function(e){e.textContent="";while(e.firstChild)e.removeChild(e.firstChild);return e};var fakeClassListMethods={_toString:function(){var e=this.node,t=e.className,n=typeof t=="string"?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;rsvg.test(t)?t.setAttribute("class",e):t.className=e}};"add,remove".replace(rword,function(e){avalon.fn[e+"Class"]=function(t){var n=this[0];return t&&typeof t=="string"&&n&&n.nodeType===1&&t.replace(/\S+/g,function(t){fakeClassList(n)[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return t.nodeType===1&&fakeClassList(t).contains(e)},toggleClass:function(e,t){var n,r=0,i=String(e).split(/\s+/),s=typeof t=="boolean";while(n=i[r++]){var o=s?t:!this.hasClass(n);this[o?"addClass":"removeClass"](n)}return this},attr:function(e,t){return arguments.length===2?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){e="data-"+hyphen(e||"");switch(arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return parseData(n);case 0:var r={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),r[e]=parseData(t.value)))}),r}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return r!==void 0?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(!n)return;return this.css("position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),e[0].tagName!=="HTML"&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0),r.top-=e.scrollTop(),r.left-=e.scrollLeft()),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){var e=this[0].offsetParent;while(e&&avalon.css(e,"position")==="static")e=e.offsetParent;return avalon(e||root)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&t.nodeType===1){var n=arguments.length===0,r=n?":get":":set",i=valHooks[getValType(t)+r];if(i)var s=i(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?s:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(e){if(typeof e=="string"){e=e.trim();if(e&&rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+e))();avalon.error("Invalid JSON: "+e)}return e},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},i=getWindow(r),s=e==="scrollTop";if(!arguments.length)return i?t in i?i[t]:root[e]:r[e];i?i.scrollTo(s?avalon(i).scrollLeft():n,s?n:avalon(i).scrollTop()):r[e]=n}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":W3C?"cssFloat":"styleFloat"};avalon.cssNumber=oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(cssMap[e])return cssMap[e];t=t||root.style;for(var r=0,i=prefixes.length;r<i;r++){n=camelize(prefixes[r]+e);if(n in t)return cssMap[e]=n}return null},cssHooks["@:set"]=function(e,t,n){try{e.style[t]=n}catch(r){}};if(window.getComputedStyle)cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n=t==="filter"?r.getPropertyValue(t):r[t],n===""&&(n=e.style[t])),n},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return t===""?"1":t};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ralpha=/alpha\([^)]*\)/i,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(rnumnonpx.test(r)&&!rposition.test(r)){var i=e.style,s=i.left,o=e.runtimeStyle.left;e.runtimeStyle.left=n.left,i.left=t==="fontSize"?"1em":r||0,r=i.pixelLeft+"px",i.left=s,e.runtimeStyle.left=o}return r==="medium"&&(t=t.replace("Width","Style"),n[t]==="none"&&(r="0px")),r===""?"auto":border[r]||r},cssHooks["opacity:set"]=function(e,t,n){var r=e.style,i=isFinite(n)&&n<=1?"alpha(opacity="+n*100+")":"",s=r.filter||"";r.zoom=1,r.filter=(ralpha.test(s)?s.replace(ralpha,i):s+" "+i).trim(),r.filter||r.removeAttribute("filter")},cssHooks["opacity:get"]=function(e){var t=e.filters.alpha||e.filters[salpha],n=t&&t.enabled?t.opacity:100;return n/100+""}}"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var n=cssHooks["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,i="offset"+e;cssHooks[t+":get"]=function(t,n,r){var s=-4;typeof r=="number"&&(s=r),n=e==="Width"?["Left","Right"]:["Top","Bottom"];var o=t[i];return s===2?o+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(s<0&&(o=o-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),s===-4&&(o=o-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),o)},cssHooks[t+"&get"]=function(e){var n=[];showHidden(e,n);var r=cssHooks[t+":get"](e);for(var i=0,s;s=n[i++];){e=s.node;for(var o in s)typeof s[o]=="string"&&(e.style[o]=s[o])}return r},avalon.fn[t]=function(s){var o=this[0];if(arguments.length===0){if(o.setTimeout)return o["inner"+e]||o.document.documentElement[n];if(o.nodeType===9){var u=o.documentElement;return Math.max(o.body[r],u[r],o.body[i],u[i],u[n])}return cssHooks[t+"&get"](o)}return this.css(t,s)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0],t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,r=n.body,i=n.documentElement,s=n.defaultView||n.parentWindow;if(!avalon.contains(i,e))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var o=i.clientTop||r.clientTop,u=i.clientLeft||r.clientLeft,a=Math.max(s.pageYOffset||0,i.scrollTop,r.scrollTop),f=Math.max(s.pageXOffset||0,i.scrollLeft,r.scrollLeft);return{top:t.top+a-o,left:t.left+f-u}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":IEVersion?function(e){return roption.test(e.outerHTML)?e.value:e.text.trim()}:function(e){return e.value},"select:get":function(e,t){var n,r=e.options,i=e.selectedIndex,s=valHooks["option:get"],o=e.type==="select-one"||i<0,u=o?null:[],a=o?i+1:r.length,f=i<0?a:o?i:0;for(;f<a;f++){n=r[f];if((n.selected||f===i)&&!n.disabled){t=s(n);if(o)return t;u.push(t)}}return u},"select:set":function(e,t,n){t=[].concat(t);var r=valHooks["option:get"];for(var i=0,s;s=e.options[i++];)if(s.selected=t.indexOf(r(s))>-1)n=!0;n||(e.selectedIndex=-1)}},meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=window.JSON&&JSON.stringify||function(e){return'"'+e.replace(/[\\\"\x00-\x1f]/g,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'},keywords=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,variablePool=new Cache(512),getVariables=function(e){var t=","+e.trim(),n=variablePool.get(t);if(n)return n;var r=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return variablePool.put(t,uniqSet(r))},evaluatorPool=new Cache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,rthimRightParentheses=/\)\s*$/,rthimOtherParentheses=/\)\s*\|/g,rquoteFilterName=/\|\s*([$\w]+)/g,rpatchBracket=/"\s*\["/g,rthimLeftParentheses=/"\s*\(/g;avalon.parseExprProxy=parseExprProxy,avalon.scan=function(e,t){e=e||root;var n=t?[].concat(t):[];scanTag(e,n)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),getBindingCallback=function(e,t,n){var r=e.getAttribute(t);if(r)for(var i=0,s;s=n[i++];)if(s.hasOwnProperty(r)&&typeof s[r]=="function")return s[r]},mergeTextNodes=IEVersion&&window.MutationObserver?function(e){var t=e.firstChild,n;while(t){var r=t.nextSibling;t.nodeType===3?n?(n.nodeValue+=t.nodeValue,e.removeChild(t)):n=t:n=null,t=r}}:0,roneTime=/^\s*::/,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled"),rnoscanAttrBinding=/^if|widget|repeat$/,rnoscanNodeBinding=/^each|with|html|include$/;if(!"1"[0])var attrPool=new Cache(512),rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(e){var t=e.outerHTML;if(t.slice(0,2)==="</"||!t.trim())return[];var n=t.match(rtag)[0],r=[],i,s,o,u=attrPool.get(n);if(u)return u;while(s=rattrs.exec(n)){o=s[2],o&&(o=(rquote.test(o)?o.slice(1,-1):o).replace(ramp,"&"));var a=s[1].toLowerCase();i=a.match(rmsAttr);var f={name:a,specified:!0,value:o||""};r.push(f)}return attrPool.put(n,r)};var rhasHtml=/\|\s*html(?:\b|$)/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g,bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),boolMap={};bools.replace(rword,function(e){boolMap[e.toLowerCase()]=e});var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},templatePool=avalon.templateCache={};bindingHandlers.attr=function(e,t){var n=stringifyExpr(e.value.trim());if(e.type==="include"){var r=e.element;e.includeRendered=getBindingCallback(r,"data-include-rendered",t),e.includeLoaded=getBindingCallback(r,"data-include-loaded",t);var i=e.includeReplace=!!avalon(r).data("includeReplace");avalon(r).data("includeCache")&&(e.templateCache={}),e.startInclude=DOC.createComment("ms-include"),e.endInclude=DOC.createComment("ms-include-end"),i?(e.element=e.startInclude,r.parentNode.insertBefore(e.startInclude,r),r.parentNode.insertBefore(e.endInclude,r.nextSibling)):(r.insertBefore(e.startInclude,r.firstChild),r.appendChild(e.endInclude))}e.handlerName="attr",parseExprProxy(n,t,e)},bindingExecutors.attr=function(e,t,n){var r=n.type,i=n.param;if(r==="css")avalon(t).css(i,e);else if(r==="attr"){var s=e===!1||e===null||e===void 0;!W3C&&propMap[i]&&(i=propMap[i]);var o=boolMap[i];typeof t[o]=="boolean"&&(t[o]=!!e,e||(s=!0));if(s)return t.removeAttribute(i);var u=rsvg.test(t)?!1:DOC.namespaces&&isVML(t)?!0:i in t.cloneNode(!1);u?t[i]=e+"":t.setAttribute(i,e)}else if(r==="include"&&e){var a=n.vmodels,f=n.includeRendered,l=n.includeLoaded,c=n.includeReplace,h=c?t.parentNode:t,p=function(t){if(l){var r=l.apply(h,[t].concat(a));typeof r=="string"&&(t=r)}f&&checkScan(h,function(){f.call(h)},NaN);var i=n.includeLastID;if(n.templateCache&&i&&i!==e){var s=n.templateCache[i];s||(s=n.templateCache[i]=DOC.createElement("div"),ifGroup.appendChild(s))}n.includeLastID=e;for(;;){var o=n.startInclude.nextSibling;if(!o||o===n.endInclude)break;h.removeChild(o),s&&s.appendChild(o)}var u=getTemplateNodes(n,e,t),c=avalon.slice(u.childNodes);h.insertBefore(u,n.endInclude),scanNodeArray(c,a)};if(n.param==="src")if(typeof templatePool[e]=="string")avalon.nextTick(function(){p(templatePool[e])});else if(Array.isArray(templatePool[e]))templatePool[e].push(p);else{var d=getXHR();d.onreadystatechange=function(){if(d.readyState===4){var t=d.status;if(t>=200&&t<300||t===304||t===1223){var n=d.responseText;for(var r=0,i;i=templatePool[e][r++];)i(n);templatePool[e]=n}}},templatePool[e]=[p],d.open("GET",e,!0),"withCredentials"in d&&(d.withCredentials=!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.send(null)}else{var v=e&&e.nodeType===1?e:DOC.getElementById(e);if(v){if(v.tagName==="NOSCRIPT"&&!v.innerHTML&&!v.fixIE78){d=getXHR(),d.open("GET",location,!1),d.send(null);var m=DOC.getElementsByTagName("noscript"),g=(d.responseText||"").match(rnoscripts)||[],y=g.length;for(var b=0;b<y;b++){var w=m[b];w&&(w.style.display="none",w.fixIE78=(g[b].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){p(v.fixIE78||v.value||v.innerText||v.innerHTML)})}}}else{!root.hasAttribute&&typeof e=="string"&&(r==="src"||r==="href")&&(e=e.replace(/&amp;/g,"&")),t[r]=e;if(window.chrome&&t.tagName==="EMBED"){var E=t.parentNode,S=document.createComment("ms-src");E.replaceChild(S,t),E.replaceChild(t,S)}}},"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr}),bindingHandlers["class"]=function(e,t){var n=e.param,r=e.value,i;e.handlerName="class";if(!n||isFinite(n)){e.param="";var s=r.replace(rexprg,function(e){return e.replace(/./g,"0")}).indexOf(":");if(s===-1){var o=r;i=!0}else o=r.slice(0,s),i=r.slice(s+1);rexpr.test(r)?o=stringifyExpr(o):o=quote(o),e.expr="["+o+","+i+"]"}else e.expr="["+quote(n)+","+r+"]",e.oldStyle=n;var u=e.type;if(u==="hover"||u==="active"){if(!e.hasBindEvent){var a=e.element,f=avalon(a),l="mouseenter",c="mouseleave";if(u==="active"){a.tabIndex=a.tabIndex||-1,l="mousedown",c="mouseup";var h=f.bind("mouseleave",function(){e.toggleClass&&f.removeClass(e.newClass)})}}var p=f.bind(l,function(){e.toggleClass&&f.addClass(e.newClass)}),d=f.bind(c,function(){e.toggleClass&&f.removeClass(e.newClass)});e.rollback=function(){f.unbind("mouseleave",h),f.unbind(l,p),f.unbind(c,d)},e.hasBindEvent=!0}parseExprProxy(e.expr,t,e)},bindingExecutors["class"]=function(e,t,n){var r=avalon(t);n.newClass=e[0],n.toggleClass=!!e[1],n.oldClass&&n.newClass!==n.oldClass&&r.removeClass(n.oldClass),n.oldClass=n.newClass,n.type==="class"&&(n.oldStyle?r.toggleClass(n.oldStyle,!!e[1]):r.toggleClass(n.newClass,n.toggleClass))},"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),bindingExecutors.data=function(e,t,n){var r="data-"+n.param;e&&typeof e=="object"?t[r]=e:t.setAttribute(r,String(e))};var duplexBinding=bindingHandlers.duplex=function(e,t){var n=e.element,r;parseExprProxy(e.value,t,e,1),e.changed=getBindingCallback(n,"data-duplex-changed",t)||noop;if(e.evaluator&&e.args){var i=[],s=oneObject("string,number,boolean,checked");n.type==="radio"&&e.param===""&&(e.param="checked"),n.msData&&(n.msData["ms-duplex"]=e.value),e.param.replace(/\w+/g,function(t){/^(checkbox|radio)$/.test(n.type)&&/^(radio|checked)$/.test(t)&&(t==="radio"&&log("ms-duplex-radio已经更名为ms-duplex-checked"),t="checked",e.isChecked=!0),t==="bool"?(t="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):t==="text"&&(t="string",log("ms-duplex-text已经更名为ms-duplex-string")),s[t]&&(r=!0),avalon.Array.ensure(i,t)}),r||i.push("string"),e.param=i.join("-"),e.bound=function(t,r){n.addEventListener?n.addEventListener(t,r,!1):n.attachEvent("on"+t,r);var i=e.rollback;e.rollback=function(){n.avalonSetter=null,avalon.unbind(n,t,r),i&&i()}};for(var o in avalon.vmodels){var u=avalon.vmodels[o];u.$fire("avalon-ms-duplex-init",e)}var a=e.pipe||(e.pipe=pipe);a(null,e,"init");var f=n.tagName;duplexBinding[f]&&duplexBinding[f](n,e.evaluator.apply(null,e.args),e)}};avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:fixNull},"boolean":{get:function(e){return e==="true"},set:fixNull},number:{get:function(e,t){var n=parseFloat(e);if(-e===-n)return n;var r=/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"];switch(r[0]){case"strong":return 0;case"medium":return e===""?"":0;case"weak":return e}},set:fixNull}};var TimerID,ribbon=[];avalon.tick=function(e){ribbon.push(e)===1&&(TimerID=setInterval(ticker,60))};var watchValueInTimer=noop,rmsinput=/text|password|hidden/;new function(){try{var e={},t=HTMLInputElement.prototype,n=HTMLTextAreaElement.prototype;function r(t){e[this.tagName].call(this,t),rmsinput.test(this.type)&&!this.msFocus&&this.avalonSetter&&this.avalonSetter()}var i=HTMLInputElement.prototype;Object.getOwnPropertyNames(i),e.INPUT=Object.getOwnPropertyDescriptor(t,"value").set,Object.defineProperty(t,"value",{set:r}),e.TEXTAREA=Object.getOwnPropertyDescriptor(n,"value").set,Object.defineProperty(n,"value",{set:r})}catch(s){watchValueInTimer=avalon.tick}},IEVersion&&avalon.bind(DOC,"selectionchange",function(e){var t=DOC.activeElement;t&&typeof t.avalonSetter=="function"&&t.avalonSetter()}),duplexBinding.INPUT=function(e,t,n){function u(e){n.changed.call(this,e,n)}function a(){o=!0}function f(){o=!1}var r=e.type,i=n.bound,s=avalon(e),o=!1,l=function(){if(o)return;var r=e.oldValue=e.value,i=n.pipe(r,n,"get");s.data("duplexObserve")!==!1&&(t(i),u.call(e,i),s.data("duplex-focus")&&avalon.nextTick(function(){e.focus()}))};n.handler=function(){var r=n.pipe(t(),n,"set")+"";r!==e.oldValue&&(e.value=r)};if(n.isChecked||r==="radio"){var c=IEVersion===6;l=function(){if(s.data("duplexObserve")!==!1){var r=n.pipe(e.value,n,"get");t(r),u.call(e,r)}},n.handler=function(){var r=t(),i=n.isChecked?!!r:r+""===e.value;e.oldValue=i,c?setTimeout(function(){e.defaultChecked=i,e.checked=i},31):e.checked=i},i("click",l)}else if(r==="checkbox")l=function(){if(s.data("duplexObserve")!==!1){var r=e.checked?"ensure":"remove",i=t();Array.isArray(i)||(log("ms-duplex应用于checkbox上要对应一个数组"),i=[i]);var o=n.pipe(e.value,n,"get");avalon.Array[r](i,o),u.call(e,i)}},n.handler=function(){var r=[].concat(t()),i=n.pipe(e.value,n,"get");e.checked=r.indexOf(i)>-1},i(W3C?"change":"click",l);else{var h=e.getAttribute("data-duplex-event")||"input";e.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event");function p(e){setTimeout(function(){l(e)})}h.replace(rword,function(e){switch(e){case"input":IEVersion?(IEVersion>8?i("input",l):i("propertychange",function(e){e.propertyName==="value"&&l()}),i("dragend",p)):(i("input",l),i("compositionstart",a),i("compositionend",f),i("DOMAutoComplete",l));break;default:i(e,l)}}),i("focus",function(){e.msFocus=!0}),i("blur",function(){e.msFocus=!1}),rmsinput.test(r)&&watchValueInTimer(function(){if(root.contains(e))!e.msFocus&&e.oldValue!==e.value&&l();else if(!e.msRetain)return!1}),e.avalonSetter=l}e.oldValue=e.value,avalon.injectBinding(n),u.call(e,e.value)},duplexBinding.TEXTAREA=duplexBinding.INPUT,duplexBinding.SELECT=function(e,t,n){function i(){if(r.data("duplexObserve")!==!1){var i=r.val();Array.isArray(i)?i=i.map(function(e){return n.pipe(e,n,"get")}):i=n.pipe(i,n,"get"),i+""!==e.oldValue&&t(i),n.changed.call(e,i,n)}}var r=avalon(e);n.handler=function(){var n=t();n=n&&n.$model||n,Array.isArray(n)?e.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):e.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),n=Array.isArray(n)?n.map(String):n+"",n+""!==e.oldValue&&(r.val(n),e.oldValue=n+"")},n.bound("change",i),e.msCallback=function(){avalon.injectBinding(n),n.changed.call(e,t(),n)}},bindingExecutors.html=function(e,t,n){var r=t.nodeType!==1,i=r?t.parentNode:t;if(!i)return;e=e==null?"":e;if(n.oldText===e)return;n.oldText=e;if(t.nodeType===3){var s=generateID("html");i.insertBefore(DOC.createComment(s),t),n.element=DOC.createComment(s+":end"),i.replaceChild(n.element,t),t=n.element}if(typeof e!="object")var o=avalon.parseHTML(String(e));else if(e.nodeType===11)o=e;else if(
e.nodeType===1||e.item){var u=e.nodeType===1?e.childNodes:e.item;o=avalonFragment.cloneNode(!0);while(u[0])o.appendChild(u[0])}u=avalon.slice(o.childNodes);if(r){var a=t.nodeValue.slice(0,-4);for(;;){var f=t.previousSibling;if(!f||f.nodeType===8&&f.nodeValue===a)break;i.removeChild(f)}i.insertBefore(o,t)}else avalon.clearHTML(t).appendChild(o);scanNodeArray(u,n.vmodels)},bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html=function(e,t){parseExprProxy(e.value,t,e)},bindingExecutors["if"]=function(e,t,n){try{if(!t.parentNode)return}catch(r){return}if(e)t.nodeType===8&&(t.parentNode.replaceChild(n.template,t),t.ifRemove=null,t=n.element=n.template),t.getAttribute(n.name)&&(t.removeAttribute(n.name),scanAttr(t,n.vmodels)),n.rollback=null;else if(t.nodeType===1){var i=n.element=DOC.createComment("ms-if");t.parentNode.replaceChild(i,t),t.ifRemove=i,n.template=t,ifGroup.appendChild(t),n.rollback=function(){t.parentNode===ifGroup&&ifGroup.removeChild(t)}}};var rdash=/\(([^)]*)\)/;bindingHandlers.on=function(e,t){var n=e.value;e.type="on";var r=e.param.replace(/-\d+$/,"");typeof bindingHandlers.on[r+"Hook"]=="function"&&bindingHandlers.on[r+"Hook"](e);if(n.indexOf("(")>0&&n.indexOf(")")>-1){var i=(n.match(rdash)||["",""])[1].trim();if(i===""||i==="$event")n=n.replace(rdash,"")}parseExprProxy(n,t,e)},bindingExecutors.on=function(e,t,n){e=function(e){var t=n.evaluator||noop;return t.apply(this,n.args.concat(e))};var r=n.param.replace(/-\d+$/,"");if(r==="scan")e.call(t,{type:r});else if(typeof n.specialBind=="function")n.specialBind(t,e);else var i=avalon.bind(t,r,e);n.rollback=function(){typeof n.specialUnbind=="function"?n.specialUnbind():avalon.unbind(t,r,i)}},bindingHandlers.repeat=function(e,t){var n=e.type;parseExprProxy(e.value,t,e,1),e.proxies=[];var r=!1;try{var i=e.$repeat=e.evaluator.apply(0,e.args||[]),s=avalon.type(i);s!=="object"&&s!=="array"?(r=!0,avalon.log("warning:"+e.value+"只能是对象或数组")):e.xtype=s}catch(o){r=!0}var u=e.value.split(".")||[];if(u.length>1){u.pop();var a=u[0];for(var f=0,l;l=t[f++];)if(l&&l.hasOwnProperty(a)){var c=l[a].$events||{};c[subscribers]=c[subscribers]||[],c[subscribers].push(e);break}}var h=e.element;if(h.nodeType===1){h.removeAttribute(e.name),e.sortedCallback=getBindingCallback(h,"data-with-sorted",t),e.renderedCallback=getBindingCallback(h,"data-"+n+"-rendered",t);var p=generateID(n),d=DOC.createComment(p),v=DOC.createComment(p+":end");e.signature=p,e.template=avalonFragment.cloneNode(!1);if(n==="repeat"){var m=h.parentNode;m.replaceChild(v,h),m.insertBefore(d,v),e.template.appendChild(h)}else{while(h.firstChild)e.template.appendChild(h.firstChild);h.appendChild(d),h.appendChild(v)}e.element=v,e.handler=bindingExecutors.repeat,e.rollback=function(){var t=e.element;if(!t)return;e.handler("clear")}}if(r)return;e.$outer={};var g="$key",y="$val";Array.isArray(i)&&(g="$first",y="$last");for(f=0;l=t[f++];)if(l.hasOwnProperty(g)&&l.hasOwnProperty(y)){e.$outer=l;break}var b=i.$events,w=(b||{})[subscribers];injectDependency(w,e),s==="object"?e.handler("append"):i.length&&e.handler("add",0,i.length)},bindingExecutors.repeat=function(e,t,n){var r=this;if(!e&&r.xtype){var i=r.$repeat,s=r.evaluator.apply(0,r.args||[]);if(r.xtype==="array"){if(i.length===s.length)return;e="add",t=0,r.$repeat=s,n=s.length}else{if(keysVM(i).join(";;")===keysVM(s).join(";;"))return;e="append",r.$repeat=s}}if(e){var o,u,a=r.element,f=getComments(r),l=a.parentNode,c=r.proxies,h=avalonFragment.cloneNode(!1);switch(e){case"add":var p=t+n,d=[];for(var v=t;v<p;v++){var m=eachProxyAgent(v,r);c.splice(v,0,m),shimController(r,h,m,d)}l.insertBefore(h,f[t]||a);for(v=0;u=d[v++];)scanNodeArray(u.nodes,u.vmodels),u.nodes=u.vmodels=null;break;case"del":sweepNodes(f[t],f[t+n]||a);var g=c.splice(t,n);recycleProxies(g,"each");break;case"clear":o=f[0],o&&(sweepNodes(o,a),r.xtype==="object"?l.insertBefore(o,a):recycleProxies(c,"each"));break;case"move":o=f[0];if(o){var y=o.nodeValue,b=[],w=[],E;sweepNodes(o,a,function(){w.unshift(this),this.nodeValue===y&&(b.unshift(w),w=[])}),sortByIndex(b,t),sortByIndex(c,t);while(w=b.shift())while(E=w.shift())h.appendChild(E);l.insertBefore(h,a)}break;case"index":var S=c.length-1;for(;n=c[t];t++)n.$index=t,n.$first=t===0,n.$last=t===S;return;case"set":m=c[t],m&&fireDependencies(m.$events[r.param||"el"]);break;case"append":var x=r.$repeat,T=Array.isArray(c)||!c?{}:c;r.proxies=T;var N=[];d=[];for(var C in T)x.hasOwnProperty(C)||(proxyRecycler(T[C],withProxyPool),delete T[C]);for(C in x)x.hasOwnProperty(C)&&C!=="hasOwnProperty"&&N.push(C);if(r.sortedCallback){var k=r.sortedCallback.call(l,N);k&&Array.isArray(k)&&k.length&&(N=k)}for(v=0;C=N[v++];)C!=="hasOwnProperty"&&(T[C]=withProxyAgent(T[C],C,r),shimController(r,h,T[C],d));l.insertBefore(h,a);for(v=0;u=d[v++];)scanNodeArray(u.nodes,u.vmodels),u.nodes=u.vmodels=null}if(!r.$repeat||r.$repeat.hasOwnProperty("$lock"))return;e==="clear"&&(e="del");var L=r.renderedCallback||noop,A=arguments;l.oldValue&&l.tagName==="SELECT"&&avalon(l).val(l.oldValue.split(",")),L.apply(l,A)}},"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat});var withProxyPool=[],eachProxyPool=[];bindingExecutors.text=function(e,t){e=e==null?"":e;if(t.nodeType===3)try{t.data=e}catch(n){}else"textContent"in t?t.textContent=e:t.innerText=e},avalon.parseDisplay=parseDisplay,bindingHandlers.visible=function(e,t){parseExprProxy(e.value,t,e)},bindingExecutors.visible=function(e,t,n){e?(t.style.display=n.display||"",avalon(t).css("display")==="none"&&(t.style.display=n.display=parseDisplay(t.nodeName))):t.style.display="none"},bindingHandlers.widget=function(e,t){var n=e.value.match(rword),r=e.element,i=n[0],s=n[1];if(!s||s==="$")s=generateID(i);var o=n[2]||i,u=avalon.ui[i];if(typeof u=="function"){t=r.vmodels||t;for(var a=0,f;f=t[a++];)if(f.hasOwnProperty(o)&&typeof f[o]=="object"){var l=f[o];l=l.$model||l;break}if(l){var c=l[i+"Id"];typeof c=="string"&&(log("warning!不再支持"+i+"Id"),s=c)}var h=avalon.getWidgetData(r,i);e.value=[i,s,o].join(","),e[i+"Id"]=s,e.evaluator=noop,r.msData["ms-widget-id"]=s;var p=e[i+"Options"]=avalon.mix({},u.defaults,l||{},h);r.removeAttribute("ms-widget");var d=u(r,e,t)||{};if(d.$id){avalon.vmodels[s]=d,createSignalTower(r,d);try{d.$init(function(){avalon.scan(r,[d].concat(t)),typeof p.onInit=="function"&&p.onInit.call(r,d,p,t)})}catch(v){}e.rollback=function(){try{d.$remove(),d.widgetElement=null}catch(e){}r.msData={},delete avalon.vmodels[d.$id]},injectDisposeQueue(e,widgetList),window.chrome&&r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(rejectDisposeQueue)})}else avalon.scan(r,t)}else t.length&&(r.vmodels=t)};var widgetList=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={truncate:function(e,t,n){return t=t||30,n=typeof n=="string"?n:"...",e.length>t?e.slice(0,t-n.length)+n:String(e)},$filter:function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t],i=avalon.filters[r.shift()];if(typeof i=="function"){var s=[e].concat(r);e=i.apply(null,s)}}return e},sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=rsanitize[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}},msPromise=function(e){this._callbacks=[];var t=this;if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof e!="function")throw new TypeError("not a function");e(function(e){_resolve(t,e)},function(e){_reject(t,e)})};msPromise.resolve=function(e){return new msPromise(function(t){t(e)})},msPromise.reject=function(e){return new msPromise(function(t,n){n(e)})},msPromise.prototype={constructor:msPromise,_state:"pending",_fired:!1,_fire:function(e,t){if(this._state==="rejected"){if(typeof t!="function")throw this._value;t(this._value)}else typeof e=="function"&&e(this._value)},_then:function(e,t){if(this._fired){var n=this;fireCallbacks(n,function(){n._fire(e,t)})}else this._callbacks.push({onSuccess:e,onFail:t})},then:function(e,t){e=typeof e=="function"?e:ok,t=typeof t=="function"?t:ng;var n=this,r=new msPromise(function(r,i){n._then(function(t){try{t=e(t)}catch(n){i(n);return}r(t)},function(e){try{e=t(e)}catch(n){i(n);return}r(e)})});for(var i in n)personal[i]||(r[i]=n[i]);return r},done:done,"catch":fail,fail:fail};var personal={_state:1,_fired:1,_value:1,_callbacks:1};msPromise.all=function(e){return _some(!1,e)},msPromise.race=function(e){return _some(!0,e)},msPromise.defer=defer,avalon.Promise=msPromise;var nativePromise=window.Promise;/native code/.test(nativePromise)&&(nativePromise.prototype.done=done,nativePromise.prototype.fail=fail,nativePromise.defer||(nativePromise.defer=defer));var global=this||(0,eval)("this"),DOC=global.document,encode=encodeURIComponent,decode=decodeURIComponent,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rhash=/#.*$/,rquery=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,r20=/%20/g,radd=/\+/g,r5b5d=/%5B(.*?)%5D$/,originAnchor=document.createElement("a");originAnchor.href=location.href;var accepts={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",script:"text/javascript, application/javascript","*":["*/"]+["*"]},useOnload=IE()===0||IE()>8;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.lastIndexOf(e,t)===t});var head=DOC.getElementsByTagName("head")[0],isLocal=!1;try{isLocal=rlocalProtocol.test(location.protocol)}catch(e){}new function(){var s=["XMLHttpRequest","ActiveXObject('MSXML2.XMLHTTP.6.0')","ActiveXObject('MSXML2.XMLHTTP.3.0')","ActiveXObject('MSXML2.XMLHTTP')","ActiveXObject('Microsoft.XMLHTTP')"];s[0]=IE()<8&&IE()!==0&&isLocal?"!":s[0];for(var i=0,axo;axo=s[i++];)try{if(eval("new "+axo)){avalon.xhr=new Function("return new "+axo);break}}catch(e){}};var supportCors="withCredentials"in avalon.xhr(),defaults={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,jsonp:"callback"},XHRMethods={setRequestHeader:function(e,t){return this.requestHeaders[e]=t,this},getAllResponseHeaders:function(){return this.readyState===4?this.responseHeadersString:null},getResponseHeader:function(e,t){if(this.readyState===4){while(t=rheaders.exec(this.responseHeadersString))this.responseHeaders[t[1]]=t[2];t=this.responseHeaders[e]}return t===undefined?null:t},overrideMimeType:function(e){return this.mimeType=e,this},abort:function(e){return e=e||"abort",this.transport&&this.respond(0,e),this},dispatch:function(e,t){var n=t;if(!this.transport)return;this.readyState=4;var r=e>=200&&e<300||e===304;if(r)if(e===204)n="nocontent";else if(e===304)n="notmodified";else if(typeof this.response=="undefined"){var i=this.options.dataType||this.options.mimeType;if(!i&&this.responseText||this.responseXML)i=this.getResponseHeader("Content-Type")||"",i=i.match(/json|xml|script|html/)||["text"],i=i[0];var s=this.responseText||"",o=this.responseXML||"";try{this.response=avalon.ajaxConverters[i].call(this,s,o)}catch(u){r=!1,this.error=u,n="parsererror"}}this.status=e,this.statusText=n+"",this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID),this._transport=this.transport;var a=this;r?(this._resolve([this.response,n,this]),window.setTimeout(function(){avalon.ajaxGlobalEvents.success(a,a.options,a.response)},0)):(this._reject([this,n,this.error]),window.setTimeout(function(){avalon.ajaxGlobalEvents.error(a,a.options,n)},0)),delete this.transport,ajaxActive--,window.setTimeout(function(){avalon.ajaxGlobalEvents.complete(a,a.options)},0),ajaxActive===0&&window.setTimeout(function(){avalon.ajaxGlobalEvents.stop()},0)}},ajaxActive=0;avalon.ajax=function(e,t){(!e||!e.url)&&avalon.error("参数必须为Object并且拥有url属性"),e=ajaxExtend(e);var n={responseHeadersString:"",responseHeaders:{},requestHeaders:{},querystring:e.querystring,readyState:0,uniqueID:(""+Math.random()).replace(/0\./,""),status:0},r,i,t=new avalon.Promise(function(e,t){i=e,r=t});t.options=e,t._reject=r,t._resolve=i;var s=[],o=[];Array("done","fail","always").forEach(function(e){t[e]=function(t){return typeof t=="function"&&(e!=="fail"&&s.push(t),e!=="done"&&o.push(t)),this}});var u=e.async===!1;u&&(avalon.log("warnning:与jquery1.8一样,async:false这配置已经被废弃"),t.async=!1),avalon.mix(t,n,XHRMethods),t.then(function(e){e=Array.isArray(e)?e:e===void 0?[]:[e];for(var n=0,r;r=s[n++];)r.apply(t,e);return e},function(e){e=Array.isArray(e)?e:e===void 0?[]:[e];for(var n=0,r;r=o[n++];)r.apply(t,e);return e}),t.done(e.success).fail(e.error).always(e.complete);var a=e.dataType,f=avalon.ajaxTransports;(e.crossDomain&&!supportCors||rjsonp.test(e.url))&&a==="json"&&e.type==="GET"&&(a=e.dataType="jsonp");var l=e.form?"upload":a,c=f[l]||f.xhr;avalon.mix(t,c),t.preproccess&&(a=t.preproccess()||a),e.contentType&&t.setRequestHeader("Content-Type",e.contentType),t.setRequestHeader("Accept",accepts[a]?accepts[a]+", */*; q=0.01":accepts["*"]);for(var h in e.headers)t.setRequestHeader(h,e.headers[h]);return e.async&&e.timeout>0&&(t.timeoutID=setTimeout(function(){t.abort("timeout"),t.dispatch(0,"timeout")},e.timeout)),ajaxActive===0&&avalon.ajaxGlobalEvents.start(),avalon.ajaxGlobalEvents.send(t,e),ajaxActive++,t.request(),t},"get,post".replace(avalon.rword,function(e){avalon[e]=function(t,n,r,i){return typeof n=="function"&&(i=i||r,r=n,n=void 0),avalon.ajax({type:e,url:t,data:n,success:r,dataType:i})}}),avalon.getScript=function(e,t){return avalon.get(e,null,t,"script")},avalon.getJSON=function(e,t,n){return avalon.get(e,t,n,"json")},avalon.upload=function(e,t,n,r,i){return typeof n=="function"&&(i=r,r=n,n=void 0),avalon.ajax({url:e,type:"post",dataType:i,form:t,data:n,success:r})},avalon.ajaxGlobalEvents={},["start","stop","complete","error","success","send"].forEach(function(e){avalon.ajaxGlobalEvents[e]=avalon.noop}),avalon.ajaxConverters={text:function(e){return e},xml:function(e,t){return t!==void 0?t:parseXML(e)},html:function(e){return avalon.parseHTML(e)},json:function(e){return avalon.parseJSON||avalon.log("avalon.parseJSON不存在,请升级到最新版"),avalon.parseJSON(e)},script:function(e){return parseJS(e),e},jsonp:function(){var e,t;return this.jsonpCallback.startsWith("avalon.")?(t=this.jsonpCallback.replace(/avalon\./,""),e=avalon[t],delete avalon[t]):e=window[this.jsonpCallback],e}};var rbracket=/\[\]$/;avalon.param=function(e){var t,n=[],r=function(e,t){t=typeof t=="function"?t():t==null?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(Array.isArray(e))avalon.each(e,r);else for(t in e)paramInner(t,e[t],r);return n.join("&").replace(r20,"+")},avalon.unparam=function(e,t,n){t=t||"&",n=n||"=";var r={};if(typeof e!="string"||e.length===0)return r;e.indexOf("?")!==-1&&(e=e.split("?").pop());var i=e.split(t);for(var s=0,o;o=i[s++];){var u=o.split("=");if(u.length===1)r[u[0]]="";else{var a=u[0].replace(radd,"%20"),f=tryDecodeURIComponent(u.slice(1).join("=").replace(radd," "));if(addSubObject(r,a,f)){var l=tryDecodeURIComponent(a);Object.prototype.hasOwnProperty.call(r,l)?Array.isArray(r[l])?r[l].push(f):r[l]=[r[l],f]:r[l]=f}}}return r};var rinput=/select|input|button|textarea/i,rcheckbox=/radio|checkbox/,rline=/\r?\n/g;avalon.serialize=function(e){var t={};return Array.prototype.filter.call(e.getElementsByTagName("*"),function(e){if(rinput.test(e.nodeName)&&e.name&&!e.disabled)return rcheckbox.test(e.type)?e.checked:!0}).forEach(function(e){var n=avalon(e).val();n=Array.isArray(n)?n.map(trimLine):trimLine(n);var r=e.name;r in t?Array.isArray(n)?t[r].push(n):t[r]=[t[r],n]:t[r]=n}),avalon.param(t,!1)};var transports=avalon.ajaxTransports={xhr:{request:function(){var e=this,t=this.options,n=this.transport=new avalon.xhr;n.open(t.type,t.url,t.async,t.username,t.password),this.mimeType&&n.overrideMimeType&&n.overrideMimeType(this.mimeType),t.crossDomain&&"withCredentials"in n&&(n.withCredentials=!0),t.crossDomain||(this.requestHeaders["X-Requested-With"]="XMLHttpRequest");for(var r in this.requestHeaders)n.setRequestHeader(r,this.requestHeaders[r]+"");if(t.progressCallback){var i=document.all&&!window.atob;i||(n.upload.onprogress=t.progressCallback)}var s=t.dataType;"responseType"in n&&/^(blob|arraybuffer|text)$/.test(s)&&(n.responseType=s,this.useResponseType=!0),n.send(t.hasContent&&(this.formdata||this.querystring)||null),!t.async||n.readyState===4?this.respond():useOnload?n.onload=n.onerror=function(t){this.readyState=4,this.status=t.type==="load"?200:500,e.respond()}:n.onreadystatechange=function(){e.respond()}},respond:function(e,t){var n=this.transport;if(!n)return;t&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID);try{var r=n.readyState===4;if(t||r){n.onreadystatechange=avalon.noop,useOnload&&(n.onerror=n.onload=null);if(t)!r&&typeof n.abort=="function"&&n.abort();else{var i=n.status,s=n.responseText;this.responseText=typeof s=="string"?s:void 0;try{var o=n.responseXML;this.responseXML=o.documentElement}catch(u){}this.useResponseType&&(this.response=n.response),this.responseHeadersString=n.getAllResponseHeaders();try{var a=n.statusText}catch(u){this.error=u,a="firefoxAccessError"}!i&&isLocal&&!this.options.crossDomain?i=this.responseText?200:404:i===1223&&(i=204),this.dispatch(i,a)}}}catch(f){t||this.dispatch(500,f)}}},jsonp:{preproccess:function(){var e=this.options,t=this.jsonpCallback=e.jsonpCallback||"avalon.jsonp"+setTimeout("1");return rjsonp.test(e.url)?e.url=e.url.replace(rjsonp,"$1"+t):e.url=e.url+(rquery.test(e.url)?"&":"?")+e.jsonp+"="+t,t.startsWith("avalon.")?(t=t.replace(/avalon\./,""),avalon[t]=function(e){avalon[t]=e}):window[t]=function(e){window[t]=e},"script"}},script:{request:function(){var e=this.options,t=this.transport=DOC.createElement("script");e.charset&&(t.charset=e.charset);var n=this;t.onerror=t[useOnload?"onload":"onreadystatechange"]=function(){n.respond()},t.src=e.url,head.insertBefore(t,head.firstChild)},respond:function(e,t){var n=this.transport;if(!n)return;t&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID);var r=/loaded|complete|undefined/i.test(n.readyState);if(t||r){n.onerror=n.onload=n.onreadystatechange=null;var i=n.parentNode;i&&i.removeChild(n);if(!t){var s;if(this.jsonpCallback){var o=this.jsonpCallback.startsWith("avalon.")?avalon[this.jsonpCallback.replace(/avalon\./,"")]:window[this.jsonpCallback];s=typeof o=="function"?[500,"error"]:[200,"success"]}else s=[200,"success"];this.dispatch.apply(this,s)}}}},upload:{preproccess:function(){var e=this.options,t;typeof e.form.append=="function"?(t=e.form,e.contentType=""):t=new FormData(e.form),avalon.each(e.data,function(e,n){t.append(e,n)}),this.formdata=t}}};avalon.mix(transports.jsonp,transports.script),avalon.mix(transports.upload,transports.xhr);if(!window.FormData){var str='Function BinaryToArray(binary)\r\n                 Dim oDic\r\n                 Set oDic = CreateObject("scripting.dictionary")\r\n                 length = LenB(binary) - 1\r\n                 For i = 1 To length\r\n                     oDic.add i, AscB(MidB(binary, i, 1))\r\n                 Next\r\n                 BinaryToArray = oDic.Items\r\n              End Function';execScript(str,"VBScript"),avalon.fixAjax=function(){function e(e){var t=avalon.parseHTML("<iframe  id='"+e+"'"+" name='"+e+"'"+" style='position:absolute;left:-9999px;top:-9999px;'/>").firstChild;return(DOC.body||DOC.documentElement).insertBefore(t,null)}function t(e,t){var n=[],r,i,s,o,u;for(r in t){i=Array.isArray(t[r]),s=i?t[r]:[t[r]];for(o=0;o<s.length;o++)u=DOC.createElement("input"),u.type="hidden",u.name=r,u.value=s[o],e.appendChild(u),n.push(u)}return n}avalon.ajaxConverters.arraybuffer=function(){var e=this.tranport&&this.tranport.responseBody;if(e)return(new VBArray(BinaryToArray(e))).toArray()},avalon.ajaxTransports.upload={request:function(){var n=this,r=this.options,i="iframe-upload-"+this.uniqueID,s=r.form,o=this.transport=e(i),u={target:s.target||"",action:s.action||"",enctype:s.enctype,method:s.method},a=r.data?t(s,r.data):[];s.target=i,s.action=r.url,s.method="POST",s.enctype="multipart/form-data",this.uploadcallback=avalon.bind(o,"load",function(e){n.respond(e)}),s.submit();for(var f in u)s[f]=u[f];a.forEach(function(e){s.removeChild(e)})},respond:function(e){var t=this.transport,n;if(!t)return;if(e&&e.type==="load"){var r=t.contentWindow.document;this.responseXML=r,r.body&&(this.responseText=r.body.innerHTML,(n=r.body.firstChild)&&n.nodeName.toUpperCase()==="PRE"&&n.firstChild&&(this.responseText=n.firstChild.nodeValue)),this.dispatch(200,"success")}this.uploadcallback=avalon.unbind(t,"load",this.uploadcallback),delete this.uploadcallback,setTimeout(function(){t.parentNode.removeChild(t)})}},delete avalon.fixAjax},avalon.fixAjax()}return avalon});